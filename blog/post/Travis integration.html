<script language="javascript" src="../include.js"></script>
<link rel="stylesheet" type="text/css" href="../file.css" />
<div class="post">
<h3 class="post-title entry-title">
    Travis integration
</h3>
<div class="post-header">
    <div class="post-header-line-1"></div>
</div>
<div class="post-body">
<a href="#todo">&#128315;&#128317;&#128315;&#128317;&#128315;&#128317;&#128315;&#128317;&#128315;&#128317;&#128315;&#128317;&#128315;</a><br />
<!-- Copy from the next line -->
<div class="summary">
    <img src="http://ArnaudBuchholz.github.io/blog/coding.png" align="left">
    This short article summarizes how Travis CI was plugged into the GPF-JS GitHub repository
    to assess quality on every push.
</div>
<code class="markdown">

## Quality control

Since the beginning of the [GPF-JS](https://github.com/ArnaudBuchholz/gpf-js) project,
[quality](https://github.com/ArnaudBuchholz/gpf-js#metrics) is a high priority topic.

Over the years, a complete development and testing framework has been built:
* Development follows **TDD** principles
* The **code is linted** with eslint *(also with jshint, even if it is redundant)*

* The **maintainability ratio** is computed using [plato](https://www.npmjs.com/package/plato) and
**verified through custom threshold** values
* **Testing is done with all supported hosts**
* The **coverage level** is measured and controlled with custom threshold values
* A **web dashboard** displays the metrics and gives access to the tools

However, these validations were done locally and they had to be **run manually before pushing the code**.

In order to **enable collaboration** and ensure that all pull requests would go to the same **validation process**,
a [continuous integration](https://en.wikipedia.org/wiki/Continuous_integration) platform was required.

Another approach consists in creating [git hooks](https://git-scm.com/book/gr/v2/Customizing-Git-Git-Hooks) to force the
quality assessment before pushing. However, it requires the submitting platform to be properly configured.
Having a central place where all the tests are being run **guarantees the correct and unbiased execution of the tests**.

## Travis CI

[Travis-CI](https://travis-ci.org/) is a **free solution** that integrates smoothly with
[GitHub](https://github.com/). Actually, the **GitHub credentials are used to login** to the platform.

After authentication, all the repositories are made available to Travis and each one can be enabled **individually**.

![Documented steps](https://arnaudbuchholz.github.io/blog/post/Travis%20integration/steps.png)

The selected repositories must be **[configured](https://docs.travis-ci.com/user/getting-started)** to
instruct Travis on **how the builds are done**. To put it in a nutshell, a new file *(.travis.yml)* must be added.

Once everything is put together, the platform will **monitor pushes and trigger builds automatically**. As a result,
it documents the push in GitHub with a flag indicating if the build succeeded.

![Successful builds](https://arnaudbuchholz.github.io/blog/post/Travis%20integration/push%20validation.png)

When opening the Travis website, the user is welcomed with a nice **dashboard listing the enabled repositories with
their respective status**.

![Travis dashboard](https://arnaudbuchholz.github.io/blog/post/Travis%20integration/dashboard.png).

The [project README](https://github.com/ArnaudBuchholz/gpf-js/blob/master/README.md) can be modified to show
the [last build result](https://github.com/ArnaudBuchholz/gpf-js#gpf-library) using an image delivered by the Travis
infrastructure:
<a href="https://travis-ci.org/ArnaudBuchholz/gpf-js#" target="_blank">
    <img src="https://travis-ci.org/ArnaudBuchholz/gpf-js.svg?branch=master" title="Travis-CI" />
</a>
<p/>

## Changes in GPF-JS

### .travis.yml

The *.yml* extension stands for **[YAML file](https://en.wikipedia.org/wiki/YAML)**: a structured format that is
commonly used for configuration files. In the context of Travis, it describes the **requirements and steps to buid and
validate** the project.

#### Requirements

One obvious requirement of the [GPF-JS](https://github.com/ArnaudBuchholz/gpf-js/blob/master/.travis.yml) development
environment is [NodeJS](https://nodejs.org/). This is configured by defining the [language setting](https://github.com/
ArnaudBuchholz/gpf-js/blob/master/.travis.yml#L1) and selecting the [Long Term Support](https://github.com/
ArnaudBuchholz/gpf-js/blob/master/.travis.yml#L2-L3) version.

Chrome is also [required](https://github.com/ArnaudBuchholz/gpf-js/blob/master/.travis.yml#L5) to enable browser
testing.

[Grunt](https://gruntjs.com/) is installed using the [proper command line](https://github.com/ArnaudBuchholz/
gpf-js/blob/master/.travis.yml#L6).

The remaining requirements are described by the [project dependencies](https://github.com/ArnaudBuchholz/
gpf-js/blob/f0e1d5a5cd48820d65754f21864e2e0a642cf3be/package.json#L24-L63) and are [installed](https://github.com/
ArnaudBuchholz/gpf-js/blob/master/.travis.yml#L7) through [NPM](https://www.npmjs.com/).

#### Steps

The default script being executed by Travis is `npm test`

The resulting commmand line is specified in the
[package.json](https://github.com/ArnaudBuchholz/gpf-js/blob/master/package.json#L11) file; it executes **grunt** with
the following tasks:
* **connectIf** to setup a local web server necessary for browser and [gpf.http](https://arnaudbuchholz.github.io/gpf/doc/gpf.http.html) testing
* **concurrent:source** to execute all tests with the source version (see [library testing
tutorial](https://arnaudbuchholz.github.io/gpf/doc/tutorial-TESTME.html))

But, first,  the GPF-JS development environment requires a configuration file to be generated: it contains the list of
detected hosts, the metrics tresholds and the HTTP port to be used to serve files.

### Configuration

<a name="todo">&#128315;&#128317;&#128315;&#128317;&#128315;&#128317;&#128315;&#128317;&#128315;&#128317;&#128315;&#128317;&#128315;</a>

Usually, the configuration file is **interactively created the very first time the grunt command is being executed**.

![Grunt config](https://arnaudbuchholz.github.io/blog/post/Travis%20integration/grunt%20config.png)

On Travis, no user can answer the questions. Hence, the generation has to be fully automatic.

This is why, a [specific grunt command](https://github.com/ArnaudBuchholz/gpf-js/blob/master/.travis.yml#L8) was
designed to generate the proper configuration file.

When grunt is triggered, the [gruntfile.js](https://github.com/ArnaudBuchholz/gpf-js/blob/v0.2.3/gruntfile.js#L17) first
checks if any configuration file exists. If not, a default configuration
is created and executed. It triggers make\config.js, the script responsible for configuration.

(...) The possibility was kept to define other configuration steps by creating files under grunt\config

### Chrome testing

No selenium (but it might be possible to enable it)

Luckily, I implemented the alternative to execute a command line
google-chrome-stable

Finding the right command line options was quite a challenge but finally got it

### Wscript is missing

Impact on coverage, add flags to coverage

This part will change: the files should be tagged with host info so that coverage would know (based on detected hosts)
    if it was possible to run

    NodeJS was used to simulate WScript environment

### Bonus: coverage with coveralls

https://github.com/ArnaudBuchholz/gpf-js/blob/master/.travis.yml#L9

</code>
<!-- Drop those two lines -->
</div>
</div>
