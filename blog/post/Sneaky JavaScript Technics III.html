<script language="javascript" src="../include.js"></script>
<link rel="stylesheet" type="text/css" href="../file.css" />
<div class="post">
<h3 class="post-title entry-title">
    Sneaky JavaScript Technics III
</h3>
<div class="post-header">
    <div class="post-header-line-1"></div>
</div>
<div class="post-body">
<!-- Copy from the next line -->
<div class="summary">
    <img src="http://ArnaudBuchholz.github.io/blog/ninja.png" align="left">
    A ninja is a master of disguise. How do you apply the JavaScript ninjutsu to hide an object member so that nobody
    can see (and use) it? Here are several ways.
</div>
<code class="markdown">
### The context

These days, I started a new [task](https://github.com/ArnaudBuchholz/gpf-js/issues/151) on my
[gpf-js project](https://github.com/ArnaudBuchholz/gpf-js) and it implies manipulating an
[AST](https://en.wikipedia.org/wiki/Abstract_syntax_tree) structure within [NodeJS](https://nodejs.org/en/).
Because the structure analysis requires to have access to the parent nodes, I augmented the AST items with a link to
their parent. The result is later serialized into
[JSON](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON) for tracing purpose but
the generated circular reference broke the conversion.

Actually, I could have used the
[replacer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Parameters)
parameter of the
[JSON.stringify](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) method
but this circular reference also caused trouble in my own code. Hence I had to find another way.

### Reflection

The JavaScript language offers some [reflection](https://en.wikipedia.org/wiki/Reflection_%28computer_programming%29)
mechanisms. Indeed, the [for..in](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in)
syntax is capable of listing all [enumerable properties](https://developer.mozilla.org/en-US/docs/Web/JavaScript/
Enumerability_and_ownership_of_properties) of any object.

(...) I would recommend using [Object.keys](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/
Global_Objects/Object/keys) instead. However, the lack of support of old browsers requires that you polyfilled it
with for..in combined with
[hasOwnProperty](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty)
.

This fundamental machinery is widely used:
* [ESlint](http://eslint.org/) offers a rule to detect [unsafe uses](http://eslint.org/docs/rules/guard-for-in)
* JavaScript evolved to make the enumerable state configurable on a property

### Object.defineProperty

The simplest way to add a property to an object is to simply do it:
`var obj = {};
obj.newProperty = "value";`

This newly created property will be enumerable by default.

[ECMAScript 5.1](http://www.ecma-international.org/ecma-262/5.1/#sec-15.2.3.6) introduced
[Object.defineProperty](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/
defineProperty) to create a configurable property.

It can be used in different ways and most of them are beyond the scope of this article.
I will mostly focus on the possibility to create a non-enumerable property:

`var obj = {};
Object.defineProperty(obj, "newProperty", {
  value: "value",
  writable: true,
  enumerable: false,
  configurable: false
});`

[Compatibility](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/
defineProperty#Browser_compatibility)

PROS
    easy to implement
    can be used since IE8

CONS
    if the dev knows the member name, he can extract the info

### Symbol

Another simple way to add a property to an object is to use the square bracket syntax:
`var obj = {};
var newPropertyName = "newProperty";
obj[newPropertyName] = "value";`

In that example, the newly created property will be named newProperty, as per the value of the variable.


https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol

https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility)

PROS
    easy to implement
    symbol can be 'private'

CONS
    Supported only from

### Wrapper

</code>
<!-- Drop those two lines -->
</div>
</div>