<script language="javascript" src="../include.js"></script>
<link rel="stylesheet" type="text/css" href="../file.css" />
<div class="post">
<h3 class="post-title entry-title">
    Release 0.2.2: gpf.require
</h3>
<div class="post-header">
    <div class="post-header-line-1"></div>
</div>
<div class="post-body">
<!-- Copy from the next line -->
<div class="summary">
    <img src="http://ArnaudBuchholz.github.io/blog/release.png" align="left">
    This new release includes a modularization helper as well as feedback from a side project.
    It also include fixes for some annoying bugs.
</div>
<code class="markdown">
## New version

Here comes the new version:
* [Stories and bugs](https://github.com/ArnaudBuchholz/gpf-js/milestone/10?closed=1) implemented
* [Sources](https://github.com/ArnaudBuchholz/gpf-js/tree/v0.2.2)
* [Documentation](https://arnaudbuchholz.github.io/gpf/0.2.2/doc/index.html)
* [NPM package](https://www.npmjs.com/package/gpf-js)

### Why did it take so long to get a new version?

First of all, no timeline is clearly defined for this project. I usually assign one month per release and I try to
commit to it. However, I prefer to take the necessary time to make sure that a release contains everything needed.

Actually, there are three main reasons to explain the delay of this release.

* The first one is
![vacations](https://arnaudbuchholz.github.io/blog/post/Release%200.2.2/vacations.jpg)

* The second reason is that I also worked on a [side project](https://github.com/ArnaudBuchholz/bubu-timer) that dragged
a lot of my time. I will later write an article about it as it was my first HTML mobile app experience with a tough
customer... my wife.

<div align="center">
    <iframe src="http://arnaudbuchholz.github.io/bubu-timer/index.html#about" width="400" height="400"></iframe>
</div>

* Last but not least, this release addresses an issue that appeared from time to time and that I never considered
seriously. Some tests were failing on a regular basis but not frequently enough to represent a real threat.
I decided to tackle this problem once for all and it brought many time-consuming challenges.

## Release content

### gpf.require

This is clearly the new feature coming with this version. It allows the developer to modularize its project by creating
separate source files that depend from each other. A separate article will be written to detail the concept (and
implementation) but, in the meantime, you may read the
[tutorial](https://arnaudbuchholz.github.io/gpf/0.2.2/doc/tutorial-REQUIRE.html) on how to use it.

To put it in a nutshell:

`gpf.require.define({
    hello: "hello.js"
}, function (require) {
    "use strict";

    console.log(require.hello()) // Output "World!"

});`

Provided the hello.js file is in the same folder and contains:

`gpf.require.define({}, function () {
    "use strict";

    return function () {
        return "World!";
    };

});`

Or (using CommonJS syntax)...
`"use strict";

module.exports = function () {
    return "World!";
};`


I was thinking about creating such a mechanism for a while but I had no clue how (and where) to start.
After reading some documentation about NodeJS and now that the library is mature enough,
I have to say that it was surprisingly easy to implement.

![I did it](https://arnaudbuchholz.github.io/blog/post/Release%200.2.2/SANDCASTLES.png)

Some of you may object that, indeed, it already exists in NodeJS and browsers (natively or through different libraries
such as [RequireJS](http://requirejs.org/) or [browserify](http://browserify.org/)). But this new mechanism brings one
uniform feature to all supported platforms. And it comes with a way to alter the require cache to simplify testing by
injecting mocked dependencies.

### Improved gpf.web.createTagFunction

When developing the mobile app, I had to play with
[Scalable Vector Graphics](https://developer.mozilla.org/en-US/docs/Web/SVG). In order to create the appropriate markup,
some specific DOM APIs must be used (such as
[createElementNS](https://developer.mozilla.org/en-US/docs/Web/API/Document/createElementNS)).
That's why I added the support of namespaces to
[gpf.web.createTagFunction](https://arnaudbuchholz.github.io/gpf/0.2.2/doc/gpf.web.html#.createTagFunction__anchor).

(...) ... But I forgot to document the use of namespaces...
an [incident](https://github.com/ArnaudBuchholz/gpf-js/issues/210) is assigned to the next release.

The same way, this method allocates a function that generates tags exposing methods (toString and appendTo).
The documentation was missing but now this is
[resolved](https://arnaudbuchholz.github.io/gpf/0.2.2/doc/gpf.typedef.Tag.html).

### Improved gpf.http layer

I realized that the [HEAD verb](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/HEAD) was not supported by the
[HTTP layer](https://arnaudbuchholz.github.io/gpf/0.2.2/doc/gpf.http.html).
It is now [possible](https://arnaudbuchholz.github.io/gpf/0.2.2/doc/gpf.http.html#.head__anchor).

Another improvement is the possibility to mock any HTTP requests by adding a
[custom handler](https://arnaudbuchholz.github.io/gpf/0.2.2/doc/gpf.typedef.html#.mockedRequest).
Using this feature, any code that involves HTTP communication can be tested independently from the web server.

For instance:

`gpf.http.mock({
    method: gpf.http.methods.get,
    url: new RegExp("echo\\?status=([0-9]+)"),
    response: function (request, status) {
        if (status === "400") {
            return; // Don't mock
        }
        return {
            status: parseInt(status, 10) + 1,
            headers: {
                "x-mock": true
            },
            responseText: "It works"
        };
    }
});

// No HTTP request will be sent to any server
gpf.http.get("/echo?status=200").then(function (response) {
    assert(response.status === 201);
    assert(response.headers["x-mock"] === true);
    assert(response.responseText === "It works");
    /*...*/
});

// But this one will...
gpf.http.get("/echo?status=400");`

### Improved Timeout & Promise tests

Timeout and promises tests rewritten

Test legacy management

### Improved quality and tooling

Increased minimum maintainability ratio to 70

Automatic scroll in grunt connect middleware

## Lessons learned


### Incompatible tests

## Next release


</code>
<!-- Drop those two lines -->
</div>
</div>