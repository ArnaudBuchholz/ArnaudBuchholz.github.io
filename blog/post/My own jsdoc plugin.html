<script language="javascript" src="../include.js"></script>
<link rel="stylesheet" type="text/css" href="../file.css" />
<div class="post">
<h3 class="post-title entry-title">
    My own jsdoc plugin
</h3>
<div class="post-header">
    <div class="post-header-line-1"></div>
</div>
<div class="post-body">
<!-- Copy from the next line -->
<div class="summary">
    <img src="http://ArnaudBuchholz.github.io/blog/student.png" align="left">
    Jsdoc provides a convenient way to document APIs by adding comments directly in the code.
    However, the task can be tedious when it comes to documenting every details of each symbol.
    Luckily, the tool provides ways to interact with the parsing process through the creation of plugins.
</div>
<code class="markdown">
## Introduction

Just before the release of [version 0.1.5](http://gpf-js.blogspot.ca/2016/12/release-015.html), I focused on
[documenting the API](https://arnaudbuchholz.github.io/gpf/0.1.5/doc/index.html).
I knew I had to use [jsdoc](http://usejsdoc.org/) so I started adding comments early in the
development process.

### Automation and validation

To make it a part of the build process, I installed [grunt-jsdoc](https://github.com/krampstudio/grunt-jsdoc) and
configured [two tasks](https://github.com/ArnaudBuchholz/gpf-js/blob/v0.1.5/grunt/jsdoc.js):
* One 'private' to see all symbols (including the private and the internal ones)
* One 'public' for the official documentation (only the public symbols)

(...) The default rendering of jsdoc is quite boring, I decided to go with
[ink-docstrap](https://www.npmjs.com/package/ink-docstrap) for the public documentation.

To make sure my jsdoc comments were consistent and correctly used, I also
[configured eslint](https://github.com/ArnaudBuchholz/gpf-js/blob/v0.1.5/.eslintrc#L29-L44) to validate them.

Finally, to avoid getting thousands of errors, I decided to control which files would be used to generate documentation
(using the source tile).

### The reality

I quickly realized that I had to do lot of copy & paste to avoid errors and generate the proper documentation.

For example: when an internal method is exposed as a public API, the comment must be copied.
* On one hand, the internal method must be flagged with
[@private](http://usejsdoc.org/tags-private.html)
* On the other hand, the public method has the same comment but flagged with
[@public](http://usejsdoc.org/tags-public.html)

`/**
 * Extends the destination object by copying own enumerable properties from the source object.
 * If the member already exists, it is overwritten.
 *
 * @param {Object} destination Destination object
 * @param {...Object} source Source objects
 * @return {Object} Destination object
 * @private
 */
function _gpfExtend (destination, source) {
    _gpfIgnore(source);
    [].slice.call(arguments, 1).forEach(function (nthSource) {
        _gpfObjectForEach(nthSource, _gpfAssign, destination);
    });
    return destination;
}

/**
 * Extends the destination object by copying own enumerable properties from the source object.
 * If the member already exists, it is overwritten.
 *
 * @param {Object} destination Destination object
 * @param {...Object} source Source objects
 * @return {Object} Destination object
 * @public
 */
gpf.extend = _gpfExtend;`

This implies double maintenance with the risk of forgetting to replace @private with @public.

The lazy developer in me started to get annoyed and I started to look at ways I could do things more efficiently.
In that case, we could instruct jsdoc to copy the comment from the internal method and use the name to detect if
the API is public or private (depending if it starts with '_').

### jsdoc plugins


    http://usejsdoc.org/about-plugins.html

## Member types

    When creating a class, I use to declare members and initialize them with a default value
    Most of the time the value type can be deduced from this default value

## Access type

### Naming convetion

    By default, all symbols are public.
    I follow the naming convention where the underscore at the beginning of the member names means that the member
    is private.

### Class definitions

    In the next versions, I will implement a class definition method and the structure will provide information about
    member visibility. The idea would be to avoid writing @private / @protected
    Will also handle @static

## Custom tags

chainable
    Same return type
    Simple description

read / write
    Defining property getters and setters

sameas
    Revealing pattern / DRY principle applied to comments

## The enumeration case

    What's the point of showing the value of an enum?
    I removed it.

## The error classes example

    That one is the most interesting example I had to go through

### Error generation in GPF-JS

    Explain that everything starts from _gpfErrorDeclare
Example:

    One method is created
    One class is created

### Documentation generation

    Two steps process

    1. Creating new documentation blocks during the beforeParse

    2. Blocking the default handling through the node visitor


## ESLint customization

valid-jsdoc.js
    return handling (
    parameter handling (signature defined)

## @since

## Conclusion

The lazy developper in me is statisfied :-)



</code>
<!-- Drop those two lines -->
</div>
</div>
