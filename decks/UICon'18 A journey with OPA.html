<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>UICon'18 A journey with OPA</title>
		<meta name="description" content="UICon'18 A journey with OPA">
		<meta name="author" content="Arnaud Buchholz">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
		<style>

.reveal h3, .reveal h4 {
	padding-bottom: 5rem;
}

.reveal cite {
	font-size: 50%;
	font-style: italic;
}

.reveal cite::before {
	content: "ðŸ—£"
}

.reveal span.pre {
	font-family: monospace;
	white-space: pre;
}

.reveal .split {
	display: inline-block;
}

.reveal .left {
	float: left;
	width: 50%;
}

.reveal .right {
	float: right;
	width: 50%;
}

strong {
	color: rgb(253, 164, 44);
}

q {
	quotes: "\00AB" "\00BB"
}

.TODO {
	background-color: #FFFFA5;
}

.TODO::before {
	content: "TODO";
	font-size: small;
}

.reveal .screenshot {
 	max-height: 70%;
	max-width: 70%;
}

.reveal pre {
	width: unset;
}

		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<section>
						<h3>A journey with <strong>OPA</strong></h3>
						<p>
							<small>
								Presented by <a href="https://github.com/ArnaudBuchholz">Arnaud Buchholz</a>
								<br/>
								Presentation made with <a href="https://github.com/hakimel/reveal.js">Reveal.js</a>
							</small>
						</p>
						<img src="UICon'18%20A%20journey%20with%20OPA/OpenUI5_new_big_side.png" height="100px" style="border: 0;" />
						<img src="UICon'18%20A%20journey%20with%20OPA/UI5Con.png" height="100px" style="border: 0;" />
					</section>
					<section>
						<h3>Arnaud <strong>Buchholz</strong></h3>
						<table>
							<tr>
								<td width="25%">
									<img src="/gfx/me40.png" />
								</td>
								<td  style="vertical-align: top;">
									<small>
										<ul>
											<li>Development Expert @ SAP</li>
											<li>In the software industry for <strong><span id="software_years"></span> years</strong></li>
											<li><strong><span id="js_years"></span> years</strong> of experience with <strong>JavaScript</strong>
												<ul>
													<li>Front-End development: <span id="fe_years"></span> years</li>
													<li>SapUI5: <span id="ui5_years"></span> years</li>
												</ul>
											</li>
											<li>Passionate, curious &amp; experimenting</li>
											<li>French and almost <strong>Canadian</strong></li>
										</ul>
									</small>
									<script>
										var year = new Date().getFullYear(),
											years = {
												software: 1998,
												js: 2008,
												fe: 2013,
												ui5: 2015
											};
										Object.keys(years).forEach(function (id) {
											document.getElementById(id + "_years").innerHTML = year - years[id];
										});
									</script>
								</td>
							</tr>
							<tr>
								<td colspan="2" style="border: 0;">
									<a href="https://ca.linkedin.com/in/arnaudbuchholz"><img src="/gfx/LinkedIn.png" style="border: 0; box-shadow: unset;" /></a>
									<a href="https://github.com/ArnaudBuchholz"><img src="/gfx/GitHub.png" style="border: 0; box-shadow: unset;" /></a>
									<a href="http://gpf-js.blogspot.com"><img src="/gfx/Blogger.png" style="border: 0; box-shadow: unset;" /></a>
								</td>
							</tr>
						</table>
					</section>
					<section>
						<h3><strong>Agenda</strong></h3>
						<ul id="agenda"></ul>
					</section>
				</section>
				<section>
					<section>
						<h3>Why <strong>automated</strong> testing?</h3>
					</section>
					<section>
						<q>If it's not tested, it doesn't work</q>
						<img src="/gfx/deadpool common sense.png" style="border: 0;" />
						<p>
							<i class="fragment" style="font-size: smaller;">Need I say more?</i>
						</p>
					</section>
					<section class="hide">
						<h4><strong>Automated</strong> vs manual testing</h4>
						<p>As the code <strong>complexity grows</strong>, it takes more and <strong>more time
						and/or resources</strong> to test the software <strong>manually</strong>.</p>
						<p>The only <strong>sustainable</strong> solution is to automate the tests
							and have them <strong>run fast</strong>.</p>
					</section>
					<section class="hide">
						<h4>Some <strong>drawbacks</strong> of automated testing</h4>
						<p>
							<q>It takes too much time</q><cite>Some Product Owners...</cite>
						</p>
						<p>This is a <strong>short term</strong> vision of automated testing:
							by reducing the number of bugs and maximizing the quality, you end up doing
							<strong>more features</strong> and <strong>less bug fixing</strong>.
						</p>
						<q>Go slow to go fast</q>
					</section>
					<section class="hide">
						<h4>Some <strong>advantages</strong> of automated testing</h4>
						<p>
							<q>Code never lies, comments sometimes do</q><cite>Ron Jeffries</cite>
						</p>
						<p>
							Automated tests ensure the <strong>proper documentation</strong> of the software:
							they showcase the application features.
						</p>
						<p>
							Tests secure <strong>future code</strong>,
							enabling fast <strong>non-regression</strong> testing.
						</p>
					</section>
					<section>
						<h4><strong>Unit</strong> testing vs <strong>Integration</strong> testing</h4>
						<img src="UICon'18%20A%20journey%20with%20OPA/test%20pyramid.png" align="left" />
						<p><strong>Maximize</strong> unit testing: they must be <strong>fast</strong> and they ensure <strong>code modularity</strong>.</p>
						<p><strong>Leverage</strong> integration testing: check the <strong>happy path</strong> then <strong>edge cases</strong>.</p>
					</section>
					<section class="hide">
						<h4><strong>Assessing</strong> test coverage</h4>
						<p>
							There are many ways to <strong>measure</strong> the tests coverage:
							<ul>
								<li>Number of scenarios tested</li>
								<li>Number of acceptance criterias tested</li>
								<li>Code coverage</li>
							</ul>
						</p>
						<p>
							Don't forget the <strong>The Pareto principle</strong>.
							<small>(a.k.a. the 80 / 20 rule)</small>
						</p>
					</section>
					<section class="hide">
						<h4><strong>Limits</strong> of code coverage</h4>
						<p>
							Code coverage gives you insights on which lines of code were executed.
							However, it does not mean that <strong>all scenarios</strong> were executed.
							<pre><code data-trim data-noescape>
								function divide (dividend, divisor) {
									return dividend / divisor;
								}

								assert(divide(2,2) === 1);
							</code></pre>
						</p>
					</section>
					<section class="hide">
						<h4>Experiences feedback</h4>
						<q>After one year working with OPA tests, I <strong>changed my mind</strong> completely concerning OPA.<br />
						It is a great opportunity to verify the <strong>robustness and quality</strong> of the UI5 developments.<br />
						At the beginning it is hard to start, <strong>with the time it becomes much more faster to develop OPA tests</strong>.</q>
						<cite>Roger Knop</cite>
					</section>
					<section class="hide">
						<h4>Experiences feedback</h4>
						<q>[...] App seems to be quite stable. The effort for OPA testing <strong>(especially at the beginning of the project)</strong> pays out!
							A good example is the Variant Management of the GanttChart [...]. At a certain point in time we thought everything would have been covered.
							But due to existing OPA tests we figured out, that some <strong>functionalities were still missing</strong> [...].</q>
						<cite>Maximilian Rupp</cite>
					</section>
					<section class="hide">
						<h4>Experiences feedback</h4>
						<q>From my expierence in other projects I already <strong>knew the value of testing</strong>. But we never did testing to that extent.
							So developing a new feature was really <strong>half implementing the functionality half writing tests</strong>.
							Which was quite some effort and sometimes a challenge.
							But along the way it really helped us <strong>discover errors, weak points and unforseen side effects</strong>.
							And in the end <strong>the quality stands for itself</strong>.</q>
						<cite>Pascal Wasem</cite>
					</section>
				</section>
				<section>
					<section>
						<h3><strong>OPA</strong> Overview</h3>
					</section>
					<section>
						<h4><strong>O</strong>ne <strong>P</strong>age <strong>A</strong>cceptance Tests</h4>
						<ul>
							<li><strong>UI integration</strong> testing</li>
							<li><strong>JavaScript</strong> based</li>
							<li>Tightly <strong>integrated</strong> with UI5</li>
							<li><strong>Asynchronous</strong> with <strong>active polling</strong> mechanisms</li>
							<li>Enables <strong>T</strong>est-<strong>D</strong>riven <strong>D</strong>evelopment through <strong>abstractions</strong></li>
						</ul>
					</section>
					<section>
						<h4>Compared to other <strong>automation frameworks</strong></h4>
						<p>Selenium, Marionette or Puppetter are <strong>framework agnostic</strong>,
							one must rely on the <strong>generated HTML</strong> to code automation (IDs, CSS selectors...).</p>
						<br/>
						<p>OPA is designed <strong>by and for</strong> UI5 developers: one manipulates <strong>UI5 controls</strong>.</p>
					</section>
					<section>
						<h4>What is <strong>OPA</strong>?</h4>
						<p>OPA is a <strong>set of tools</strong> used to automate UI <i>(and offering backend mocking)</i>.</p>
						<br/>
						<p>Tests are organized in <strong>Journeys</strong>, based on <strong>Pages</strong> to abstract the UI, and <strong>readable</strong>.</p>
					</section>
					<section>
						<h4>An <strong>example</strong> of one OPA test</h4>
						<pre id="opa_sample"><code data-trim data-noescape>
							opaTest("should remove completed items", function(Given, When, Then) {
								// Arrangements
								Given.iStartTheApp();

								// Actions
								When.onTheAppPage.iEnterTextForNewItemAndPressEnter(S_NEW_ITEM_TITLE);
								When.onTheListOfItems.iSetTheItemToCompleted(S_NEW_ITEM_TITLE);
								When.onTheAppPage.iClearTheCompletedItems();

								// Assertions
								Then.onTheListOfItems.iShouldNotSeeAnyItemTitled(S_NEW_ITEM_TITLE)
									.and.iTeardownTheApp();
							});
						</code></pre>
					</section>
					<section>
						<h4><strong>Executing</strong> OPA tests</h4>
						<ul>
							<li>As <strong>simple</strong> as running a web page</li>
							<li>A <strong>qUnit report</strong> documents execution results</li>
							<br />
							<li>Application can be run in two different modes:
								<ul>
									<li>As a component <strong>within</strong> the test window</li>
									<li>Inside an <strong>iFrame</strong> <i>(slower but isolated)</i></li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h4><strong>Limits</strong> of OPA</h4>
						<ul>
							<li>Designed to test <strong>one UI5</strong> application</li>
							<li>Not <strong>integrated</strong> with backend</li>
						</ul>
					</section>
				</section>
				<section>
					<section>
						<h3>Pages <strong>&</strong> Journeys</h3>
					</section>
					<section>
						<h4><string>Pages</strong></h4>
						<p>
							They are used to <strong>abstract</strong> UI elements
						</p>
					</section>
					<section>
						<h4>Pages Examples</h4>
						<img src="UICon'18%20A%20journey%20with%20OPA/Pages%201.png" class="screenshot" />
					</section>
					<section>
						<h4>Pages Actions & Assertions</h4>
						<ul>
							<li>onTheListOfItems
								<pre><code data-trim data-noescape>
									When.onTheListOfItems.iSetTheItemToCompleted(S_NEW_ITEM_TITLE);
									Then.onTheListOfItems.iShouldSeeTheNewItem(S_NEW_ITEM_TITLE);
								</code></pre>
							</li>
							<li>onTheFilterButtons
								<pre><code data-trim data-noescape>
									When.onTheFilterButtons.iClick(filters.COMPLETED);
									Then.onTheFilterButtons.iShouldSeeTheButtonCount(filters.COMPLETED, 4);
								</code></pre>
							</li>
						</ul>
					</section>
					<section>
						<h4>Pages Examples</h4>
						<img src="UICon'18%20A%20journey%20with%20OPA/Pages%202.png" class="screenshot" />
					</section>
					<section>
						<h4>Pages Actions & Assertions</h4>
						<ul>
							<li>onTheEditDialog
								<pre><code data-trim data-noescape>
									When.onTheEditDialog.iClickSave();
									When.onTheEditDialog.iClickClose();
									Then.onTheEditDialog.iShouldSeeTheTitleField();
									Then.onTheEditDialog.iShouldNotSeeTheTitleField();
								</code></pre>
							</li>
						</ul>
					</section>
					<section>
						<h4>Pages <strong>implementation</strong></h4>
						<pre><code data-trim data-noescape>
							sap.ui.define([
								"sap/ui/test/Opa5"
							], function(Opa5) {
								Opa5.createPageObjects({
									onAbstractNamePage: {
										/*baseClass: ClassOfferingCommonHelpers*/,
										actions: {
											iExecuteAnAction: function() { return this.waitFor(/*...*/); },
											/*...*/
										},
										assertions: {
											iCheckAnAssertion: function() { return this.waitFor(/*...*/); },
											/*...*/
										}
									}
								});
							});
						</code></pre>
						<p>Makes an <strong>extensive use</strong> of <span class="pre">this.waitFor</span><p>
					</section>
					<section>
						<h4><strong>Journeys</strong></h4>
						<ul>
							<li>Relying on pages' methods, they describe the <strong>user experience</strong> within the
								application</li>
							<br/>
							<li>A journey is composed of <strong>tests</strong></li>
							<br/>
							<li>Each test follow the pattern
								<ul>
									<li><strong>Given</strong>: setup the initial state of the test</li>
									<li><strong>When</strong>: execute actions</li>
									<li><strong>Then</strong>: check assertions</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h4>Journey <strong>implementation</strong></h4>
						<pre><code data-trim data-noescape>
							sap.ui.define([
								"sap/ui/test/opaQunit"
							], function(opaTest) {
								QUnit.module("Journey name");
								opaTest("Test name", function(Given, When, Then) {
									Given.iStartMyApp();
									When.onAbstractNamePage.iExecuteAnAction()
										.and.iExecuteAnotherAction();
									Then.onAbstractNamePage.iCheckAnAssertion()
										.and.iTeardownMyAppFrame();
								});
								opaTest("Test name 2", function(Given, When, Then) {/*...*/});
								/*...*/
							});
						</code></pre>
					</section>
					<section>
						<h4><strong>Loading</strong> pages & journeys</h4>
						<ul>
							<li>Ensure <strong>qUnit</strong> is loaded</li>
							<li>Load OPA, pages & journeys</li>
							<li><strong>Start</strong></li>
						</ul>
					<!-- </section>
					<section>
						<h4>Example of loading</h4> -->
						<pre><code data-trim data-noescape>
							sap.ui.require([
								"sap/ui/test/Opa5",
								/* pages */
								/* journeys */
							], function(Opa5) {
								Opa5.extendConfig({
									/* Default settings */
								});
								QUnit.start();
							});
						</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h3>Anatomy of <strong>waitFor</strong></h3>
					</section>
					<section>
						<h4><strong>Presentation</strong> of waitFor</h4>
						<ul>
							<li><strong>Main</strong> entry point to <strong>synchronize</strong> tests with the running application</li>
							<br/>
							<li><strong>Locate</strong> and <strong>interact</strong> with UI5 controls</li>
						</ul>
					</section>
					<section>
						<h4>waitFor is <strong>asynchronous</strong></h4>
						<pre><script>document.write(document.getElementById("opa_sample").innerHTML)</script></pre>
						<ul>
							<li><span class="pre">Given.iStartMyApp</span> starts the application synchronously</li>
							<li>All pages members, relying on waitFor, fill a stack of waitFor to be executed</li>
							<li><span class="pre">iTeardownMyAppFrame</span> is also asynchronous</li>
						</ul>
					</section>
					<section>
						<h4><strong>Filtering</strong></h4>
						<hr />
						<div class="split">
							<div class="left">
								<ul>
									<li>id: string or regexp</li>
									<li>controlType: class or base class</li>
									<li>viewNamespace & viewName</li>
								</ul>
							</div>
							<div class="right">
								<div class="TODO">find an illustration</div>
							</div>
						</div>
						<hr />
						<small>No filtering criteria means <strong>all controls</strong></small>
						<br/>
						<small>Polling until <strong>something found</strong> or timeout</small>
					</section>
					<section>
						<h4><strong>Matchers</strong></h4>
						<small>Given the resultset of previous step</small>
						<hr />
						<div class="split">
							<div class="left">
								<ul>
									<li>Can filter out / replace one by one</li>
									<li>Falsy value => removed</li>
								</ul>
							</div>
							<div class="right">
								<div class="TODO">find an illustration</div>
							</div>
						</div>
						<hr />
						<small>Polling until <strong>remaining results</strong> or timeout</small>
					</section>
					<section>
						<h4><strong>Checker</strong></h4>
						<small>Given the resultset of previous step</small>
						<hr />
						<div class="split">
							<div class="left">
								<ul>
									<li>Can accept or reject all results</li>
								</ul>
							</div>
							<div class="right">
								<div class="TODO">find an illustration</div>
							</div>
						</div>
						<hr />
						<small>Polling until <strong>truthy</strong> or timeout</small>
					</section>
					<section>
						<h4><strong>actions</strong></h4>
						<small>Given the resultset of previous step</small>
						<hr />
						<div class="split">
							<div class="left">
								<ul>
									<li>Press or EnterText</li>
									<li>Executed on all results</li>
									<li>capable of adapting to the target control<br />
										<small>For instance, Press on a search field will trigger the search and EnterText will enter search
										criteria.</small>
									</li>
								</ul>
							</div>
							<div class="right">
								<div class="TODO">find an illustration</div>
							</div>
						</div>
						<hr />
					</section>
					<section>
						<h4><strong>success</strong></h4>
						<small>Given the resultset of previous step</small>
						<hr />
						<div class="split">
							<div class="left">
								<ul>
									<li>Final step of the waitFor</li>
									<li>Should never test control state in success: if failed, the whole test fails</li>
									<li>Can chain to a subsequent waitFor</li>
								</ul>
							</div>
							<div class="right">
								<div class="TODO">find an illustration</div>
							</div>
						</div>
						<hr />
					</section>
					<section>
						<h4><strong>autoWait</strong></h4>
						<ul>
							<li>When enabled, waitFor monitors <strong>pending tasks</strong>
								and includes the <strong>Interactable matcher</strong><br/>
								<small>Pending tasks are: requests, timeouts, promises, UI navigation...</small>
							</li>
							<br />
							<li>Use <span class="pre">sap.ui.test.Opa5.extendConfig</span> to <strong>set it globally</strong></li>
							<li>Can be <strong>turned off</strong> in a specific waitFor.<br />
								<small>For instance if you want to check that a button is disabled</small>
							</li>
						</ul>
					</section>
					<section>
						<h4><strong>timeout</strong></h4>
						<ul>
							<li>The timeout setting decides of the maximum polling time</li>
							<li>pollingInterval can be set <i>(defaulted to 400ms)</i>
							<li>When enabled, autoWait monitors unfinished asynchronous work (requests, timeouts, promises, UI navigation...)
								and includes the sap.ui.test.matchers.Interactable matcher to all waitFor.</li>
						</ul>
						Controls states are tested to check that they are 'available' and 'interactable'
					</section>
				</section>
				<section>
					<section>
						<h3><strong>Mocking</strong> Backend</h3>
					</section>
					<section>
						<h4>Backend</h4>
						- **CRUD** on entities
						- **Entities** storage & generation
						- **Request** mocking

					</section>
					<section>
						<h4>MockServer</h4>
					</section>
				</section>
				<section>
					<section>
						<h3><strong>Our</strong> initiatives</h3>
					</section>
					<section>
						<h4>Automatic Performance <strong>monitoring</strong></h4>
					</section>
					<section>
						<h4><strong>Extensibility</strong> & Runtime Adaptation</h4>
					</section>
				</section>
			</div>
		</div>
		<script>
			// Build agenda
			[].slice.call(document.querySelectorAll("h3"), 3).forEach(function (h3) {
				var item = document.createElement("li");
				[].slice.call(h3.childNodes, 0).forEach(function (node) {
					item.appendChild(node.cloneNode(true));
				});
				this.appendChild(item);
			}, document.getElementById("agenda"));
			// Remove hidden slides
			[].slice.call(document.querySelectorAll(".hide")).forEach(function (node) {
				node.parentNode.removeChild(node);
			});
			// Replace tabs with double spaces in code samples to reduce code width
			[].slice.call(document.querySelectorAll("code")).forEach(function (node) {
				node.innerHTML = node.innerHTML.replace(/	/g, "  ");
			});
		</script>
		<script src="http://arnaudbuchholz.github.io/gpf/0.2.6/gpf.js"></script>
		<script>
		gpf.require.define({Reveal: "reveal.js"}, function (require) {
			"use strict";
			require.Reveal.configure({
				slideNumber: "c/t"
			});
		});
		</script>
	</body>
</html>
