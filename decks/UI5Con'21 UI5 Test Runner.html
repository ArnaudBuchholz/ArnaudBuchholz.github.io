<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="description" content="UI5Con'21 A different approach to UI5 tests execution">
		<meta name="author" content="Arnaud Buchholz">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
		<meta name="deck-duration" content="40">
		<meta name="deck-theme" content="night">
		<link rel="stylesheet" type="text/css" href="styles.css">
		<style>
section > section {
	background-image: url("UI5Con'21 UI5 Test Runner/UI5con logo.png");
	background-repeat: no-repeat;
	background-size: 15%;
	background-position: bottom right;
}

.print-pdf section > div > section {
	background-image: url("UI5Con'21 UI5 Test Runner/UI5con logo.png");
	background-repeat: no-repeat;
	background-size: 15%;
	background-position: bottom right;
}

section.title {
	background-image: none;
	text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
}

.print-pdf section.title {
	background-image: none;
	text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
}

section.title h3 {
	text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
}

.print-pdf section.title h3 {
	text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black !important;
}

section.divider {
	background-image: url("UI5Con'21 UI5 Test Runner/UI5con divider.png");
	background-repeat: no-repeat;
	background-size: 30%;
	background-position: bottom right;
}

.print-pdf section.divider {
	background-image: url("UI5Con'21 UI5 Test Runner/UI5con divider.png");
	background-repeat: no-repeat;
	background-size: 15%;
	background-position: bottom right;
}

section.divider h3 {
	text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
}

.reveal.center .slides section {
    min-height: 90%!important;
}

.print-pdf .reveal.center .slides section {
    min-height: unset!important;
}

img.rounded {
	margin: 0;
	border: 0;
	box-shadow: unset;
	border-radius: 16px;
}

.reveal pre {
	margin-bottom: 0;
}
		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<section class="title">
						<table>
							<tr>
								<td width="50%">
									<small>
										<a href="https://www.imdb.com/title/tt0120201/"><small>Starship Troopers</small>
											<img src="UI5Con'21 UI5 Test Runner/good_bug.png" class="rounded"></img>
										</a>
									</small>
								</td>
								<td style="vertical-align: top;">
									<h3 data-agenda="no">A <strong>different</strong> approach to UI5 <strong>tests execution</strong></h3>
									<p>
										<small>
											Presented by <a href="https://github.com/ArnaudBuchholz">Arnaud Buchholz</a>
											<br/>
											Presentation made with <a href="https://github.com/hakimel/reveal.js">Reveal.js</a>
										</small>
									</p>
									<br/>
									<img src="UI5Con'21 UI5 Test Runner/UI5con title.png" style="position: absolute; bottom: 0px; right: 0px; z-index: -1; height: 80%;" />
								</td>
							</tr>
						</table>
					</section>
					<section include="me.html"></section>
					<section>
						<h3 data-agenda="no"><strong>Agenda</strong></h3>
						<ul id="agenda"></ul>
					</section>
					<section>
						<h4>Presented <img src="/gfx/GitHub_w.png" style="margin: 0; border: 0; box-shadow: unset;" /><strong>projects</strong></h4>
						<ul>
							<li>
								<a href="https://openui5.org/">OpenUI5</a><br/>
								<small>An enterprise-grade, responsive &amp; open source <strong>UI framework</strong></small>
							</li>
							<li>
								<a href="https://github.com/ArnaudBuchholz/training-ui5Con18-opa">training-ui5con18-opa</a><br/>
								<small>A <strong>todo list</strong> developed with <strong>OpenUI5</strong> to <strong>illustrate</strong></a> the testing concepts</small>
							</li>
							<li>
								<a href="https://www.npmjs.com/package/reserve">REserve</a><br/>
								<small>A <strong>lightweight</strong> web server</small>
							</li>
							<li>
								<a href="https://github.com/ArnaudBuchholz/ui5-test-runner">ui5-test-runner</a><br/>
								<small>A <strong>UI5</strong> test runner</small>
							</li>
						</ul>
						<p>
						</p>
					</section>
					<section>
						<h4><strong>About</strong> the presentation</h4>
						<ul>
							<li class="fragment">UI5 <strong>ecosystem</strong> is growing</li>
							<li class="fragment"><a href="https://github.com/SAP/ui5-tooling"><strong>UI5 tooling</strong></a> is the <strong>recommended</strong> solution for UI5 <strong>development</strong></li>
						</ul>
						<br/>
						<br/>
						<br/>
						<p class="fragment"><strong>Innovation</strong> <i>sometimes</i> requires <strong>ignoring</strong> recommendations &#128517;</p>
					</section>
				</section>
				<section>
					<section class="divider">
						<h3><strong>Context</strong></h3>
						<q>Back to 2018...</q>
					</section>
					<section>
						<h4>UI5Con<strong>'18</strong></h4>
						<img src="From OPA to Node-UI5/UI5con@SAP 2018 - A journey with OPA.png" style="border: 0; max-width: 40%; max-height: 40%;" />
						<br/>
						<p>A journey with <strong>OPA</strong></p>
						<small><a href="https://youtu.be/HiZq-kuIbt0">recording</a> <a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa">training-ui5con18-opa</a></small>
					</section>
					<section>
						<h4>UI5Con<strong>'19</strong></h4>
						<img src="UI5Con'19 Advanced Testing with UI5/YouTube.png" style="border: 1px solid black; max-width: 50%; max-height: 50%;" />
						<br/>
						<p>Use <strong>UI5</strong> to <strong>test</strong> your <strong>ODATA</strong> service</p>
						<small><a href="https://youtu.be/HiZq-kuIbt0">recording</a> <a href="https://www.npmjs.com/package/node-ui5">node-ui5</a></small>
					</section>
					<section>
						<s><h4>UI5Con<strong>'20</strong></h4></s>
						<div class="fragment">
							<img src="UI5Con'21 UI5 Test Runner/9781493219513_267_2d.png" style="border: 0; max-width: 50%; max-height: 50%;" />
							<br/>
							<p><strong>Testing</strong> UI5 applications</p>
							<small><a href="https://www.sap-press.com/testing-sapui5-applications_5056/">e-book</a></small>
						</div>
						<br/>
					</section>
					<section>
						<q>Got the <strong>trend</strong> ?</q>
					</section>
					<section>
						<h4><strong>Quality</strong> focus</h4>
						<ul>
							<li>Team is responsible of <strong>10+</strong> applications</li>
							<li><strong>Requirement</strong> to have at least <strong>80%</strong> of coverage</li>
							<li><strong>Huge</strong> tests suites <i>(up to 45 minutes)</i></li>
						</ul>
					</section>
					<section>
						<h4><strong>Pipeline</strong> issues</h4>
						<ul>
							<li>CI pipeline uses the <strong>Karma</strong> runner</li>
							<li>OPA tests based on the <strong>iFrame mode</strong></li>
							<li><strong>Huge</strong> memory consumption</li>
							<li>Tests are abruptly <strong>aborted</strong> <i class="fragment">(browser crash)</i></li>
						</ul>
					</section>
					<section>
						<h4><strong>Give</strong> me a &#128077; if...</h4>
						<p class="fragment">You <strong>use</strong> Karma</p>
						<p class="fragment">You <strong>understand</strong> how Karma <strong>executes</strong> the tests</p>
						<br/>
						<p class="fragment">... I do <strong>not</strong> understand &#128561;</p>
					</section>
					<section>
						<h4><strong>Karma</strong> execution model</h4>
						<ul>
							<li><strong>All</strong> tests in <strong>one</strong> window</li>
							<li><strong>One</strong> iFrame to <strong>run</strong> them all</li>
							<li><strong>Sequential</strong> execution</li>
							<li><strong>Coverage</strong> information</li>
						</ul>
					</section>
					<section>
						<h4><strong>Demo</strong></h4>
						<p>Karma tests runner</p>
						<img src="UI5Con'21 UI5 Test Runner/Karma demo.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<figcaption><code>npm run karma</code></figcaption>
					</section>
					<section>
						<h4><strong>Demo</strong></h4>
						<p>Karma tests runner (CI)</p>
						<img src="UI5Con'21 UI5 Test Runner/Karma ci demo.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<figcaption><code>npm run karma-ci</code></figcaption>
					</section>
				</section>
				<section>
					<section class="divider">
						<h3><strong>Serving</strong> an <strong>UI5</strong> application</h3>
						<img src="UI5Con'21 UI5 Test Runner/serving.jpg" class="rounded" style="max-width: 50%; max-height: 50%;" />
					</section>
					<section>
						<h4><strong>Development</strong> setting</h4>
						<ul>
							<li>UI5 <strong>loaded</strong> with <code>sap-ui-core.js</code>
								<small>
									<ul>
										<li>No <strong>specific</strong> version</li>
										<li>Path is <strong>relative</strong> to the project
									</ul>
								</small>
							</li>
<pre><code class="html">&lt;script id="sap-ui-bootstrap" src="../resources/sap-ui-core.js"
	data-sap-ui-theme="sap_fiori_3"
	data-sap-ui-libs="sap.m"
	data-sap-ui-resourceroots='{"Demo": "./"}'
	data-sap-ui-onInit="module:Demo/index"
	data-sap-ui-async="true"&gt;
&lt;/script&gt;</code></pre>
<figcaption>Example of UI5 bootstrap</figcaption>
							</li>
							<li>All <strong>dependencies</strong> are under <code>/resources/</code> <small>or <code>/test-resources/</code></small></li>
						</ul>
					</section>
					<section>
						<h4><strong>Running</strong> the application (<strong>WebIDE</strong>)</h4>
						<ul>
							<li><strong>Mapping</strong> configured with <code>neo-app.json</code>
								<small>
									<ul>
										<li>Enables <strong>fast</strong> version selection</li>
									</ul>
								</small>
								<div style="text-align: center;">
									<img src="UI5Con'21 UI5 Test Runner/WebIDE.gif" style="border: 0; max-width: 50%; max-height: 50%;" />
									<figcaption>WebIDE</figcaption>
								</div>
							</il>
							<li><strong>No</strong> installation but <strong>hard</strong> to automate</il>
						</ul>
					</section>
					<section>
						<h4><strong>Running</strong> the application (<strong>@ui5/cli</strong>)</h4>
						<ul>
							<li>UI5 <strong>packages</strong> are installed <strong>locally</strong>
								<small>
									<ul>
										<li><strong>Fastidious</strong> version switch</li>
									</ul>
								</small>
								<div style="text-align: center;">
									<img src="UI5Con'21 UI5 Test Runner/ui5 serve.gif" style="border: 0; max-width: 50%; max-height: 50%;" />
									<figcaption>ui5 serve -o</figcaption>
								</div>
							</il>
							<li><strong>Heavy</strong> but <strong>automated</strong></il>
						</ul>
					</section>
					<section>
						<h4><strong>Running</strong> the application (<strong>UI5 CDN</strong>)</h4>
						<ul>
							<li>Load UI5 from a <strong>Content Delivery Network</strong>
								<small>
									<ul>
										<li>Version selection requires to <strong>change the bootstrap</strong></li>										
										<li>A <strong>web server</strong> is required to deliver the project files</li>
									</ul>
								</small>
								<pre><code class="html">&lt;script id="sap-ui-bootstrap"
	src="https://openui5.hana.ondemand.com/1.87.0/resources/sap-ui-core.js"
	data-sap-ui-theme="sap_fiori_3"
	data-sap-ui-libs="sap.m"
	data-sap-ui-resourceroots='{"Demo": "./"}'
	data-sap-ui-onInit="module:Demo/index"
	data-sap-ui-async="true"&gt;
&lt;/script&gt;</code></pre>
<figcaption>UI5 bootstrap from CDN</figcaption>
						</li>
						<li><strong>Lite</strong> setup but <strong>how</strong> do we automate ?</li>
					</ul>
					</section>
					<section>
						<p>Can we combine a <strong>lightweight</strong> setup<br/>
							with a <strong>fast &amp; external</strong> version selection ?</p>
						<br/>
						<br/>
						<p class="fragment">...In an <strong>automatable</strong> way ?</p>
					</section>
					<section>
						<h4>Introducing <strong>REserve</strong></h4>
						<p>Small, configurable <strong>and</strong> reusable</p>
						<pre><code class="json">{
	"port": 8080,
	"mappings": [{
		"match": "/(test-)?resources/(.*)",
		"url": "https://openui5.hana.ondemand.com/1.87.0/$1resources/$2"
	}, {
		"match": "^/(.*)",
		"file": "./webapp/$1"
	}]
}</code></pre>
<figcaption>Example JSON configuration file to serve an UI5 application</figcaption>
					<a href="https://www.npmjs.com/package/reserve" target="blank">reserve</a>
					<img async-src="https://img.shields.io/npm/dw/reserve.svg" height="30px" src="https://img.shields.io/npm/dw/reserve.svg">
					<a href="https://packagephobia.now.sh/result?p=reserve" target="_blank" class="img-only">
						<img async-src="https://packagephobia.now.sh/badge?p=reserve" height="30px" src="https://packagephobia.now.sh/badge?p=reserve">
					</a>
					</section>
					<section>
						<h4><strong>Demo</strong></h4>
						<p>Serving an UI5 application with REserve</p>
						<img src="UI5Con'21 UI5 Test Runner/REserve demo.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<figcaption><code>npm run reserve</code></figcaption>
						<small>
							<a href="http://localhost:8080/test/testsuite.qunit.html">Test suite</a>
						</small>
					</section>
					<section>
						<img src="UI5Con'21 UI5 Test Runner/good_bug.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<h4>Would you like to know <strong>more</strong> ?</h4>
						<small>
							<a href="https://arnaud-buchholz.medium.com/reserve-serving-an-openui5-application-2f0211f057e2" target="_blank">
								REserve — Serving an OpenUI5 application
							</a>
						</small>
					</section>
				</section>
				<section>
					<section class="divider">
						<h3><strong>Building</strong> a test platform</h3>
						<img src="UI5Con'21 UI5 Test Runner/platform.jpg" class="rounded" style="max-width: 50%; max-height: 50%;" />
					</section>
					<section>
						<h4>Defining the <strong>options</strong></h4>
						<p>Every aspect of the platform is <br/>
							<strong>configurable</strong> through options :</p>
						<ul>
							<li><strong>Location</strong> of the <code>webapp</code> folder</li>
							<li><strong>URL</strong> of the <code>UI5</code> CDN</li>
							<li><strong>Serving</strong> port</li>
							<li>...</li>
						</ul>
						<br/>
						<br/>
						<a href="https://www.npmjs.com/package/ui5-test-runner" target="blank">ui5-test-runner</a>
						<img async-src="https://img.shields.io/npm/dw/ui5-test-runner.svg" height="30px" src="https://img.shields.io/npm/dw/ui5-test-runner.svg">
					</section>
					<section>
						<h4><strong>Serving</strong> the application</h4>
						<p>Done by <strong>embedding</strong> <code>REserve</code></p>
						<pre><code class="javascript">const { check, serve } = require('reserve')
check({
		port: job.port,
		mappings: [{
			match: '/(test-)?resources/(.*)', // UI5 mapping
			url: `${job.ui5}/$1`
		}, {
			match: /^\/(.*)/, // Project mapping
			file: join(job.webapp, '$1')
		}]
	})
		.then(configuration => serve(configuration))
}</code></pre>
<figcaption>Embedding REserve inside an application</figcaption>
					</section>
					<section>
						<h4><strong>Spawning</strong> a browser (1/3)</h4>
						<p>To <strong>automate</strong> the tests execution, the platform needs a way to <strong>start</strong> a browser
							and <strong>stop</strong> it when the tests are <strong>done</strong> <i>(or the <strong>timeout</strong> is reached).</i></p>
						<p>The <strong>browser instantiation</strong> is deferred to a <strong>configurable</strong> script that is <strong>spawned</strong> by the platform.</p>
					</section>
					<section>
						<h4><strong>Spawning</strong> a browser (2/3)</h4>
						<p>By <strong>default</strong>, a <a href="https://www.npmjs.com/package/puppeteer"><code>puppeteer</code></a> script is provided</p>
						<pre><code class="javascript">const puppeteer = require('puppeteer')
let browser
process.on('message', async message => {
  if (message.command === 'stop') { // End signal
    await browser.close()
    process.exit(0)
  }
})
async function main () {
  browser = await puppeteer.launch({
    headless: true,
    args: [process.argv[2] /* Test page to open */, /* ... */]
  })
}
main()</code></pre>
<figcaption>Browser instantiation script</figcaption>
					</section>
					<section>
						<h4><strong>Spawning</strong> a browser (3/3)</h4>
						<p>Tests were conducted to validate that <br/>
							<strong>multiple and concurrent instances</strong> <br/>
							do not <strong>interfere</strong> with each other :</p>
						<ul>
							<li>Timeouts</li>
							<li>Local storage</li>
							<li>Cache</li>
							<li>...</li>
						</ul>
					</section>
					<section>
						<h4>Custom <strong>endpoints</strong> (1/2)</h4>
						<p>During the tests execution, the platform needs to <strong>receive feedback</strong> from the browsers.<br/>
							<small><i>For instance : to know when a test ends</i></small></p>
						<p>Dedicated <strong>endpoints</strong> are created.<br/><small>(base URL : <code>/_/</code>)</small><p>
						<p>The endpoints leverage the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer"><code>referer</code></a> header to <br/>
							<strong>identify</strong> which test <i>(test page URL)</i> initiated the <strong>request</strong>.</p>
					</section>
					<section>
						<h4>Custom <strong>endpoints</strong> (2/2)</h4>
						<pre><code class="javascript">const { body } = require('reserve')
function endpoint (implementation) {
  return async function (request, response) {
    response.writeHead(200)
    response.end()
    const url = request.headers.referer
    const data = JSON.parse(await body(request))
    try {
      await implementation.call(this, url, data)
    } catch (e) {
      console.error(`Exception when processing ${url}`, e)
    }
  }
}</code></pre>
<figcaption>Reusable endpoint implementation</figcaption>
					</section>
					<section>
						<h4><strong>Demo</strong></h4>
						<p>Serving an UI5 application with the platform</p>
						<img src="UI5Con'21 UI5 Test Runner/ui5-test-runner platform.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<figcaption><code>ui5-test-runner -parallel:0 -port:8080</code></figcaption>
						<small>
							<a href="http://localhost:8080/test/testsuite.qunit.html">Test suite</a>
						</small>
					</section>
					<section>
						<img src="UI5Con'21 UI5 Test Runner/good_bug.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<h4>Would you like to know <strong>more</strong> ?</h4>
						<small>
							<a href="https://arnaud-buchholz.medium.com/reserve-testing-ui5-building-a-platform-e86727b41ec4" target="_blank">
								REserve — Testing UI5 — Building a platform
							</a>
						</small>
					</section>
				</section>
				<section>
					<section class="divider">
						<h3><strong>Probing</strong> the tests</h3>
						<img src="UI5Con'21 UI5 Test Runner/7658449002_0646d75738_c.jpg" class="rounded" style="max-width: 50%; max-height: 50%;" />
					</section>
					<section>
						<h4><strong>Declaring</strong> the tests (1/3)</h4>
						<p>The <strong>test suite</strong> page<br/>
							<strong>declares every</strong> unit and OPA tests<br/>contained in the project.
						</p>
						<small>
							<a href="https://sapui5.hana.ondemand.com/#/topic/07c97a2e497d443eb6fa74bb9445ab9c">
								<code>webapp/test/testsuite.qunit.html</code>
							</a>
						</small>
					</section>
					<section>
						<h4><strong>Declaring</strong> the tests (2/3)</h4>
						<p>When opening the page, a <strong>redirection</strong> occurs <br/> and a runner <strong>executes</strong> the declared tests.</p>
						<img src="UI5Con'21 UI5 Test Runner/UI5 runner.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<figcaption>UI5 test runner</figcaption>
					</section>
					<section>
						<h4><strong>Declaring</strong> the tests (3/3)</h4>
						<pre><code class="javascript">&lt;html&gt;
	&lt;head&gt;
		&lt;script src="../resources/sap/ui/qunit/qunit-redirect.js"&gt;&lt;/script&gt;
		&lt;script&gt;
		function suite() {
			var oSuite = new parent.jsUnitTestSuite(),
				iLastSep = location.pathname.lastIndexOf("/") + 1,
				sContextPath = location.pathname.substring(0, iLastSep);
			oSuite.addTestPage(sContextPath + "unit/unitTests.qunit.html");
			oSuite.addTestPage(sContextPath + "integration/opaTests.qunit.html");
			return oSuite;
		}
		&lt;/script&gt;
	&lt;/head&gt;
&lt;/html&gt;</code></pre>
<figcaption>Tests declaration in the <code>testsuite.qunit.html</code></figcaption>
					</section>
					<section>
						<h4>Test suite <strong>extraction</strong> (1/2)</h4>
						<p>By <strong>substituting</strong> <code>qunit-redirect.js</code> <br/>
							with a <strong>custom script</strong> and <br/>
							opening <code>testsuite.qunit.html</code>, <br/>
							the platform <strong>captures</strong> the <strong>list</strong> of test pages.</p>
						</section>
					<section>
						<h4>Test suite <strong>extraction</strong> (2/2)</h4>
<pre><code class="javascript">const pages = []
function jsUnitTestSuite () {}
jsUnitTestSuite.prototype.addTestPage = function (url) {
	pages.push(url)
}
window.jsUnitTestSuite = jsUnitTestSuite // Expose
window.addEventListener('load', function () {
	suite() // Trigger
	const xhr = new XMLHttpRequest()
	xhr.open('POST', '/_/addTestPages')
	xhr.send(JSON.stringify(pages))
})</code></pre>
<figcaption>Custom <code>qunit-redirect.js</code> used to extract test pages</figcaption>
					</section>
					<section>
						<h4><strong>Demo</strong></h4>
						<p>Substituting <code>qunit-redirect.js</code></p>
						<img src="UI5Con'21 UI5 Test Runner/ui5-test-runner list pages.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<figcaption><code>ui5-test-runner -parallel:-1 -port:8080</code></figcaption>
						<small>
							<a href="https://openui5.hana.ondemand.com/1.87.0/resources/sap/ui/qunit/qunit-redirect.js">original <code>qunit-redirect.js</code></a>
							<br/>
							<a href="http://localhost:8080/resources/sap/ui/qunit/qunit-redirect.js">substituted <code>qunit-redirect.js</code></a>
						</small>
					</section>
					<section>
						<img src="UI5Con'21 UI5 Test Runner/good_bug.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<h4>Would you like to know <strong>more</strong> ?</h4>
						<small>
							<a href="https://arnaud-buchholz.medium.com/reserve-testing-ui5-probing-the-tests-5ad68ac8c93" target="_blank">
								REserve — Testing UI5 — Probing the tests
							</a>
						</small>
					</section>
				</section>
				<section>
					<section class="divider">
						<h3><strong>Executing</strong> the tests</h3>
						<img src="UI5Con'21 UI5 Test Runner/slot-car-racing-Melbourne.jpg" class="rounded" style="max-width: 50%; max-height: 50%;" />
					</section>
					<section>
						<h4>QUnit <strong>hooks</strong></h4>
						<p>The OPA framework is built <strong>on top of</strong> <code>QUnit</code>.</p>
						<p><code>QUnit</code> exposes <strong>hooks</strong> to <strong>monitor</strong> the tests :</p>
						<ul>
							<li><a href="https://api.qunitjs.com/callbacks/QUnit.begin/"><code>QUnit.begin</code></a></li>
							<li><a href="https://api.qunitjs.com/callbacks/QUnit.testDone"><code>QUnit.testDone</code></a></li>
							<li><a href="https://api.qunitjs.com/callbacks/QUnit.done/"><code>QUnit.done</code></a></li>
						</ul>
						<p>They provide information about <br/>
							<strong>progress</strong> and <strong>status</strong>.</p>
					</section>
					<section>
						<h4><strong>Injecting</strong> the hooks</h4>
						<p>When the test page <strong>loads</strong> the <code>QUnit</code> module, <br/>
							the platform <strong>injects</strong> code to <strong>leverage the hooks</strong> <br/>
							and trigger specific <strong>endpoints</strong>.</p>
						<small>
							<a href="http://localhost:8080/resources/sap/ui/thirdparty/qunit.js"><code>qunit.js</code></a><br/>
							<a href="http://localhost:8080/resources/sap/ui/thirdparty/qunit-2.js"><code>qunit-2.js</code></a>
						</small>
					</section>
					<section>
						<h4>Execution <strong>queue</strong> (1/2)</h4>
						<p>After <strong>probing</strong> the tests, the platform knows the <strong>list</strong> of test page URL.</p>
						<p>Then, it instantiates concurrent browsers to run <strong>each</strong> page <strong>individually</strong>. <br/>
						<small>The number of concurrent browsers is given by the option <code>parallel</code>.</small></p>
						<p>The test page is <strong>stopped</strong> when the test is done <i>(<code>QUnit.testDone</code>)</i> or when the <strong>timeout</strong> is reached.</p>
					</section>
					<section>
						<h4>Execution <strong>queue</strong> (2/2)</h4>
<pre><code class="javascript">for (let i = 0; i &lt; job.parallel; ++i) runTestPage()

async function runTestPage () {
	const { length } = job.testPageUrls
	if (job.testPagesCompleted === length) { 
		return generateReport() // Last test completed
	}
	if (job.testPagesStarted === length) {
		return // No more tests to run
	}
	const url = job.testPageUrls[job.testPagesStarted++]
	await start(url) // Resolved when the browser is stopped (or timed out)
	++job.testPagesCompleted
	runTestPage()
}</code></pre>
<figcaption>Execution queue simplified implementation</figcaption>
					</section>
					<section>
						<h4><strong>Demo</strong></h4>
						<p>Executing the tests in parallel</p>
						<img src="UI5Con'21 UI5 Test Runner/ui5-test-runner demo.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<figcaption><code>ui5-test-runner -parallel:2 -port:8080 -cache:.ui5 -keepAlive:true</code></figcaption>
						<small>
							<a href="http://localhost:8080/_/progress.html">Progress</a> <a href="http://localhost:8080/_/report.html">report</a>
						</small>
					</section>
					<section>
						<img src="UI5Con'21 UI5 Test Runner/good_bug.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<h4>Would you like to know <strong>more</strong> ?</h4>
						<small>
							<a href="https://arnaud-buchholz.medium.com/reserve-testing-ui5-executing-tests-294322d41b60" target="_blank">
								REserve — Testing UI5 — Executing tests
							</a>
						</small>
					</section>
				</section>
				<section>
					<section class="divider">
						<h3><strong>Measuring</strong> code coverage</h3>
						<img src="UI5Con'21 UI5 Test Runner/nyc.jpg" class="rounded" style="max-width: 50%; max-height: 50%;" />
					</section>
					<section>
						<h4><strong>Understanding</strong> code coverage</h4>
						<p>The process requires three steps :</p>
						<ul>
							<li><strong>Instrumentation</strong> of the code</li>
							<li><strong>Evaluation</strong> of the code</li>
							<li><strong>Extraction</strong> and <strong>consolidation</strong> of measurement</li>
						</ul>
					</section>
					<section>
						<h4><strong>NYC</strong></h4>
						<p><code>nyc</code> is a command line <strong>wrapper</strong> for <code>Istanbul</code>, <br/>
							a javascript code coverage tool.</p>
						<p>The platform leverage <code>nyc</code> by <strong>spawning</strong> commands and <strong>waiting</strong> for their termination.</p>
						<a href="https://www.npmjs.com/package/nyc" target="blank">nyc</a>
						<img async-src="https://img.shields.io/npm/dw/nyc.svg" height="30px" src="https://img.shields.io/npm/dw/nyc.svg">
						<a href="https://packagephobia.now.sh/result?p=nyc" target="_blank" class="img-only">
							<img async-src="https://packagephobia.now.sh/badge?p=nyc" height="30px" src="https://packagephobia.now.sh/badge?p=nyc">
						</a>
					</section>
					<section>
						<h4><strong>Instrumenting</strong> sources</h4>
						<p>The instrumentation step is triggered <strong>before</strong> executing the tests.
							By default, the test files are <strong>excluded</strong> from the coverage report.</p>
						<p>NYC <strong>aggregates</strong> the collected coverage information at the <strong>window level</strong>.
							Because of the <strong>IFrame</strong> usage in OPA, this is changed to the <strong>top window</strong> by the platform.</p>
					</section>
					<section>
						<h4><strong>Injecting</strong> instrumented sources</h4>
						<p>When an instrumented file <strong>exists</strong> for a source file, it is <strong>substituted</strong>.</p>
<pre><code class="javascript">/* Reserve mappings : */ [{
  match: /^\/(.*\.js)$/,
  file: join(instrumentedSourceDir, '$1'),
  'ignore-if-not-found': true
}, {
  match: /^\/(.*)/,
  file: join(job.webapp, '$1')
}]</code></pre>
<figcaption>Injecting instrumented files if they exist</figcaption>
					</section>
					<section>
						<h4><strong>Consolidating</strong> code coverage</h4>
						<p>Each test page is executed <strong>separately</strong> : corresponding coverage data is <strong>saved</strong> at the end of each test page.</p>
						<p>When all the tests are <strong>completed</strong>, NYC is used to <strong>merge</strong> the coverage information and <strong>generate</strong> the coverage report.</p>
					</section>
					<section>
						<h4><strong>Demo</strong></h4>
						<p>Coverage measurement</p>
						<img src="UI5Con'21 UI5 Test Runner/ui5-test-runner coverage.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<figcaption><code>ui5-test-runner -parallel:2 -port:8080 -cache:.ui5 -keepAlive:true</code></figcaption>
						<small>
							<a href="http://localhost:8080/_/coverage/lcov-report/index.html">Coverage report</a>
						</small>
					</section>
					<section>
						<img src="UI5Con'21 UI5 Test Runner/good_bug.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						<h4>Would you like to know <strong>more</strong> ?</h4>
						<small>
							<a href="https://arnaud-buchholz.medium.com/reserve-testing-ui5-measuring-code-coverage-ef303af051ef" target="_blank">
								REserve — Testing UI5 — Measuring code coverage
							</a>
						</small>
					</section>
				</section>
				<section>
					<section class="divider">
						<h3><code>ui5-test-runner</code></h3>
					</section>
					<section>
						<h4><strong>Karma</strong> execution model</h4>
						<ul>
							<li><strong>Generic</strong> but <strong>adapted</strong> to UI5</li>
							<li><strong>All</strong> tests in <strong>one</strong> window <br/>
								<small><strong>One</strong> iFrame to <strong>run</strong> them all</small></li>
							<li><strong>Sequential</strong> execution</li>
							<li><strong>Coverage</strong> information</li>
							<br/>
							<li><strong>Obscure</strong> implementation</li>
						</ul>
						<br/>
						<a href="https://www.npmjs.com/package/karma" target="blank">karma</a>
						<img async-src="https://img.shields.io/npm/dw/karma.svg" height="30px" src="https://img.shields.io/npm/dw/karma.svg">
						<a href="https://packagephobia.now.sh/result?p=karma" target="_blank" class="img-only">
							<img async-src="https://packagephobia.now.sh/badge?p=karma" height="30px" src="https://packagephobia.now.sh/badge?p=karma">
						</a>
					</section>
					<section>
						<h4><strong>ui5-test-runner</strong> execution model</h4>
						<ul>
							<li><strong>Specific</strong> to UI5</li>
							<li><strong>Each</strong> test page in a <strong>distinct</strong> window</li>
							<li><strong>Parallel</strong> execution</li>
							<li><strong>Coverage</strong> information</li>
							<br/>
							<li><strong>Crystal clear</strong> implementation</li>
						</ul>
						<br/>
						<a href="https://www.npmjs.com/package/ui5-test-runner" target="blank">ui5-test-runner</a>
						<img async-src="https://img.shields.io/npm/dw/ui5-test-runner.svg" height="30px" src="https://img.shields.io/npm/dw/ui5-test-runner.svg">
<!--
						<a href="https://packagephobia.now.sh/result?p=ui5-test-runner" target="_blank" class="img-only">
							<img async-src="https://packagephobia.now.sh/badge?p=ui5-test-runner" height="30px" src="https://packagephobia.now.sh/badge?p=ui5-test-runner">
						</a>
-->
					</section>
					<section>
						<h4><strong>Tips</strong> & Tricks</h4>
						<ul>
							<li>To benefit from <strong>parallelization</strong>, <strong>split</strong> the OPA tests by <strong>journeys</strong> <br/>
								<small>(see <a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa/blob/master/webapp/test/testsuite.qunit.html"><code>training-ui5Con18-opa</code></a>)</small></li>
							<li><strong>Cache</strong> UI5 locally to <strong>speed up</strong> page execution</li>
						</ul>
					</section>
					<section>
						<h4>Ideas to <strong>improve</strong> the platform</h4>
						<ul>
							<li><strong>Smarter</strong> watch <br/><small>(test only what is impacted by the change)</small></li>
							<li>Test <strong>grids</strong> <br/><small>(using <strong>Selenium</strong> integration)</small></li>
						</ul>
					</section>
				</section>
				<section>
					<section class="title">
						<div style="text-align: left;">
							<h3 data-agenda="no"><strong>Thank you !</strong></h3>
							<small>
								<b><strong>Arnaud Buchholz</strong></b><br/>
								Development Expert<br/>
								<a href="https://www.npmjs.com/package/ui5-test-runner" target="blank">npm ui5-test-runner</a>
							</small>
						</div>
						<img src="UI5Con'21 UI5 Test Runner/UI5con title.png" style="position: absolute; bottom: 0px; right: 0px; z-index: -1; height: 80%;" />
					</section>
				</section>
			</div>
		</div>
		<script src="/gpf/last/gpf.js"></script>
		<script src="deck.js"></script>
	</body>
</html>
