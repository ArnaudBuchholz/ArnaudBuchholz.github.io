<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>UI5Con'18 A journey with OPA</title>
		<meta name="description" content="UI5Con'18 A journey with OPA">
		<meta name="author" content="Arnaud Buchholz">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
		<style>

.reveal h3, .reveal h4 {
	padding-bottom: 5rem;
}

.reveal cite {
	font-size: 50%;
	font-style: italic;
}

.reveal cite::before {
	content: "ðŸ—£"
}

.reveal a::before {
	content: "ðŸ”—"
}

.reveal a.missingSampleApp::before {
	content: "ðŸ›ˆ"
}

.reveal span.pre {
	font-family: monospace;
	white-space: pre;
}

.reveal .split {
	display: inline-block;
}

.reveal .left {
	float: left;
	width: 50%;
}

.reveal .right {
	float: right;
	width: 50%;
}

strong {
	color: rgb(253, 164, 44);
}

q {
	quotes: "\00AB" "\00BB"
}

.TODO {
	background-color: #FFFFA5;
}

.TODO::before {
	content: "TODO";
	font-size: small;
}

.reveal .screenshot {
 	max-height: 70%;
	max-width: 70%;
}

.reveal pre {
	width: unset;
}

		</style>
	</head>
	<body onload="onLoad()">
		<div class="reveal">
			<div class="slides">
				<section>
					<section>
						<h3>A journey with <strong>OPA</strong></h3>
						<p>
							<small>
								Presented by <a href="https://github.com/ArnaudBuchholz">Arnaud Buchholz</a>
								<br/>
								Presentation made with <a href="https://github.com/hakimel/reveal.js">Reveal.js</a>
							</small>
						</p>
						<img src="UI5Con'18%20A%20journey%20with%20OPA/OpenUI5_new_big_side.png" height="100px" style="border: 0;" />
						<img src="UI5Con'18%20A%20journey%20with%20OPA/UI5Con.png" height="100px" style="border: 0;" />
					</section>
					<section>
						<h3>Arnaud <strong>Buchholz</strong></h3>
						<table>
							<tr>
								<td width="25%">
									<img src="/gfx/me40.png" />
								</td>
								<td  style="vertical-align: top;">
									<small>
										<ul>
											<li>Development Expert @ SAP</li>
											<li>In the software industry for <strong><span id="software_years"></span> years</strong></li>
											<li><strong><span id="js_years"></span> years</strong> of experience with <strong>JavaScript</strong>
												<ul>
													<li>Front-End development: <span id="fe_years"></span> years</li>
													<li>SapUI5: <span id="ui5_years"></span> years</li>
												</ul>
											</li>
											<li>Passionate, curious &amp; experimenting</li>
											<li>French and almost <strong>Canadian</strong></li>
										</ul>
									</small>
									<script>
										var year = new Date().getFullYear(),
											years = {
												software: 1998,
												js: 2008,
												fe: 2013,
												ui5: 2015
											};
										Object.keys(years).forEach(function (id) {
											document.getElementById(id + "_years").innerHTML = year - years[id];
										});
									</script>
								</td>
							</tr>
							<tr>
								<td colspan="2" style="border: 0;">
									<a href="https://ca.linkedin.com/in/arnaudbuchholz"><img src="/gfx/LinkedIn.png" style="border: 0; box-shadow: unset;" /></a>
									<a href="https://github.com/ArnaudBuchholz"><img src="/gfx/GitHub.png" style="border: 0; box-shadow: unset;" /></a>
									<a href="http://gpf-js.blogspot.com"><img src="/gfx/Blogger.png" style="border: 0; box-shadow: unset;" /></a>
								</td>
							</tr>
						</table>
					</section>
					<section>
						<h3><strong>Agenda</strong></h3>
						<ul id="agenda"></ul>
					</section>
					<section>
						<h4><strong>Sample</strong> application</h4>
						<ul>
							<li>A simple  <a href="http://localhost:8080"><strong>todo list</strong></a></li>
							<li>Developed to <a href="http://localhost:8080/test/integration/opaTests.qunit.html"><strong>illustrate</strong></a> the OPA concepts</li>
							<li><a href="https://travis-ci.org/ArnaudBuchholz/training-ui5con18-opa/jobs/389337036#L1995"><strong>100%</strong></a> coverage</li>
							<li><a href="https://travis-ci.org/ArnaudBuchholz/training-ui5con18-opa"><strong>Continuous Integration</strong></a> builds</li>
						</ul>
						<p>
							<a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa">
								<img src="/gfx/GitHub.png" style="margin: 0; border: 0; box-shadow: unset;" />training-ui5con18-opa
							</a>
						</p>
					</section>
				</section>
				<section>
					<section>
						<h3>Why <strong>Automated</strong> Testing?</h3>
					</section>
					<section>
						<q>If it's not tested, it doesn't work</q>
						<p>
							<i class="fragment" style="font-size: smaller;">Need I say more?</i>
						</p>
					</section>
					<section class="hide">
						<h4><strong>Automated</strong> vs manual testing</h4>
						<p>As the code <strong>complexity grows</strong>, it takes more and <strong>more time
						and/or resources</strong> to test the software <strong>manually</strong>.</p>
						<p>The only <strong>sustainable</strong> solution is to automate the tests
							and have them <strong>run fast</strong>.</p>
					</section>
					<section class="hide">
						<h4>Some <strong>drawbacks</strong> of automated testing</h4>
						<p>
							<q>It takes too much time</q><cite>Some Product Owners...</cite>
						</p>
						<p>This is a <strong>short term</strong> vision of automated testing:
							by reducing the number of bugs and maximizing the quality, you end up doing
							<strong>more features</strong> and <strong>less bug fixing</strong>.
						</p>
						<q>Go slow to go fast</q>
					</section>
					<section class="hide">
						<h4>Some <strong>advantages</strong> of automated testing</h4>
						<p>
							<q>Code never lies, comments sometimes do</q><cite>Ron Jeffries</cite>
						</p>
						<p>
							Automated tests ensure the <strong>proper documentation</strong> of the software:
							they showcase the application features.
						</p>
						<p>
							Tests secure <strong>future code</strong>,
							enabling fast <strong>non-regression</strong> testing.
						</p>
					</section>
					<section>
						<h4><strong>Unit</strong> testing vs <strong>Integration</strong> testing</h4>
						<img src="UI5Con'18%20A%20journey%20with%20OPA/test%20pyramid.png" style="border: 0; max-width: 50%; max-height: 50%;" align="left" />
						<p><strong>Maximize</strong> unit testing: they must be <strong>fast</strong> and they ensure <strong>code modularity</strong>.</p>
						<p><strong>Leverage</strong> integration testing: check the <strong>happy path</strong> then <strong>edge cases</strong>.</p>
					</section>
					<section class="hide">
						<h4><strong>Assessing</strong> test coverage</h4>
						<p>
							There are many ways to <strong>measure</strong> the tests coverage:
							<ul>
								<li>Number of scenarios tested</li>
								<li>Number of acceptance criterias tested</li>
								<li>Code coverage</li>
							</ul>
						</p>
						<p>
							Don't forget the <strong>The Pareto principle</strong>.
							<small>(a.k.a. the 80 / 20 rule)</small>
						</p>
					</section>
					<section class="hide">
						<h4><strong>Limits</strong> of code coverage</h4>
						<p>
							Code coverage gives you insights on which lines of code were executed.
							However, it does not mean that <strong>all scenarios</strong> were executed.
							<pre><code data-trim data-noescape>
								function divide (dividend, divisor) {
									return dividend / divisor;
								}

								assert(divide(2,2) === 1);
							</code></pre>
						</p>
					</section>
					<section class="hide">
						<h4>Experiences feedback</h4>
						<q>After one year working with OPA tests, I <strong>changed my mind</strong> completely concerning OPA.<br />
						It is a great opportunity to verify the <strong>robustness and quality</strong> of the UI5 developments.<br />
						At the beginning it is hard to start, <strong>with the time it becomes much more faster to develop OPA tests</strong>.</q>
						<cite>Roger Knop</cite>
					</section>
					<section class="hide">
						<h4>Experiences feedback</h4>
						<q>[...] App seems to be quite stable. The effort for OPA testing <strong>(especially at the beginning of the project)</strong> pays out!
							A good example is the Variant Management of the GanttChart [...]. At a certain point in time we thought everything would have been covered.
							But due to existing OPA tests we figured out, that some <strong>functionalities were still missing</strong> [...].</q>
						<cite>Maximilian Rupp</cite>
					</section>
					<section class="hide">
						<h4>Experiences feedback</h4>
						<q>From my expierence in other projects I already <strong>knew the value of testing</strong>. But we never did testing to that extent.
							So developing a new feature was really <strong>half implementing the functionality half writing tests</strong>.
							Which was quite some effort and sometimes a challenge.
							But along the way it really helped us <strong>discover errors, weak points and unforseen side effects</strong>.
							And in the end <strong>the quality stands for itself</strong>.</q>
						<cite>Pascal Wasem</cite>
					</section>
				</section>
				<section>
					<section>
						<h3><strong>OPA</strong> Overview</h3>
					</section>
					<section>
						<h4><strong>O</strong>ne <strong>P</strong>age <strong>A</strong>cceptance Tests</h4>
						<ul>
							<li><strong>UI behavior</strong> testing</li>
							<li><strong>JavaScript</strong> based</li>
							<li>Tightly <strong>integrated</strong> with UI5</li>
							<li><strong>Asynchronous</strong> with <strong>active polling</strong> mechanisms</li>
							<li>Enables <strong>T</strong>est-<strong>D</strong>riven <strong>D</strong>evelopment through <strong>abstractions</strong></li>
						</ul>
					</section>
					<section>
						<h4>Compared to other <strong>automation frameworks</strong></h4>
						<p>Selenium, Marionette or Puppetter are <strong>framework agnostic</strong>,
							one must rely on the <strong>generated HTML</strong> to code automation (IDs, CSS selectors...).</p>
						<br/>
						<p>OPA is designed <strong>by and for</strong> UI5 developers: one manipulates <strong>UI5 controls</strong>.</p>
					</section>
					<section>
						<h4>What is <strong>OPA</strong>?</h4>
						<p>OPA is a set of tools used to <strong>automate</strong> and <strong>validate</strong> UI
							<i>(and it comes with backend mocking)</i>.</p>
						<br/>
						<p>Tests are organized in <strong>Journeys</strong>, based on <strong>Pages</strong> to abstract the UI,
							and <strong>readable</strong>.</p>
					</section>
					<section>
						<h4>An <strong>example</strong> of one OPA test</h4>
						<pre id="opa_sample"><code data-trim data-noescape>
							opaTest("should remove completed items", function(Given, When, Then) {
								// Arrangements
								Given.iStartTheApp();

								// Actions
								When.onTheAppPage.iEnterTextForNewItemAndPressEnter(S_NEW_ITEM_TITLE);
								When.onTheListOfItems.iSetTheItemToCompleted(S_NEW_ITEM_TITLE);
								When.onTheAppPage.iClearTheCompletedItems();

								// Assertions
								Then.onTheListOfItems.iShouldNotSeeAnyItemTitled(S_NEW_ITEM_TITLE)
									.and.iTeardownTheApp();
							});
						</code></pre>
						<small>Given, When, Then <strong>pattern</strong></small>
					</section>
					<section>
						<h4><strong>Executing</strong> OPA tests</h4>
						<ul>
							<li>As <strong>simple</strong> as running a web page</li>
							<li>A <strong>qUnit report</strong> documents execution results</li>
							<br />
							<li class="hide">Application can be run in two different modes:
								<ul>
									<li>As a component <a href="http://localhost:8080/test/integration/opaTests.qunit.html?component=true"><strong>within</strong></a> the test window</li>
									<li>Inside an <a href="http://localhost:8080/test/integration/opaTests.qunit.html"><strong>iFrame</strong></a> <i>(slower but isolated)</i></li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h4><strong>Limits</strong> of OPA</h4>
						<ul>
							<li>Designed to test <strong>one UI5</strong> application</li>
							<li><strong>Not designed</strong> to test backend</li>
						</ul>
					</section>
				</section>
				<section>
					<section>
						<h3>Pages <strong>&</strong> Journeys</h3>
					</section>
					<section>
						<h4><string>Pages</strong></h4>
						<p>
							They are used to <strong>abstract</strong> UI elements
						</p>
					</section>
					<section>
						<h4>Pages <strong>Examples</strong></h4>
						<img src="UI5Con'18%20A%20journey%20with%20OPA/Pages%201.png" class="screenshot" />
					</section>
					<section>
						<h4>Pages <strong>Actions</strong> & <strong>Assertions</strong></h4>
						<ul>
							<li>onTheListOfItems
								<pre><code data-trim data-noescape>
									/* ... */
									When.onTheListOfItems.iSetTheItemToCompleted(S_NEW_ITEM_TITLE);
									Then.onTheListOfItems.iShouldSeeTheNewItem(S_NEW_ITEM_TITLE);
									/* ... */
								</code></pre>
							</li>
							<li>onTheFilterButtons
								<pre><code data-trim data-noescape>
									/* ... */
									When.onTheFilterButtons.iClick(filters.COMPLETED);
									Then.onTheFilterButtons.iShouldSeeTheButtonCount(filters.ALL, 4);
									/* ... */
								</code></pre>
							</li>
						</ul>
					</section>
					<section>
						<h4>Pages <strong>Examples</strong></h4>
						<img src="UI5Con'18%20A%20journey%20with%20OPA/Pages%202.png" class="screenshot" />
					</section>
					<section>
						<h4>Pages <strong>Actions</strong> & <strong>Assertions</strong></h4>
						<ul>
							<li>onTheEditDialog
								<pre><code data-trim data-noescape>
									/* ... */
									Then.onTheEditDialog.iShouldSeeTheTitleField();
									When.onTheEditDialog.iClickClose();
									/* ... */
								</code></pre>
							</li>
						</ul>
					</section>
					<section>
						<h4>Pages <strong>implementation</strong></h4>
						<pre><code data-trim data-noescape>
							sap.ui.define([
								"sap/ui/test/Opa5"
							], function(Opa5) {
								Opa5.createPageObjects({
									onAbstractNamePage: {
										/*baseClass: ClassOfferingCommonHelpers*/,
										actions: {
											iExecuteAnAction: function() { return this.waitFor(/*...*/); },
											/*...*/
										},
										assertions: {
											iCheckAnAssertion: function() { return this.waitFor(/*...*/); },
											/*...*/
										}
									}
								});
							});
						</code></pre>
						<p>Makes an <strong>extensive use</strong> of <span class="pre">this.waitFor</span><p>
						<sample>Filters=test/integration/pages/Filters.js</sample>
					</section>
					<section>
						<h4><strong>Journeys</strong></h4>
						<ul>
							<li>Relying on pages' methods, they describe the <strong>user experience</strong> within the
								application</li>
							<br/>
							<li>A journey is composed of <strong>tests</strong></li>
							<br/>
							<li>Each test follows the pattern
								<ul>
									<li><strong>Given</strong>: setup the initial state of the test</li>
									<li><strong>When</strong>: execute actions</li>
									<li><strong>Then</strong>: check assertions</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h4>Journey <strong>implementation</strong></h4>
						<pre><code data-trim data-noescape>
							sap.ui.define([
								"sap/ui/test/opaQunit"
							], function(opaTest) {
								QUnit.module("Journey name");
								opaTest("Test name", function(Given, When, Then) {
									Given.iStartMyApp();
									When.onAbstractNamePage.iExecuteAnAction()
										.and.iExecuteAnotherAction();
									Then.onAbstractNamePage.iCheckAnAssertion()
										.and.iTeardownMyAppFrame();
								});
								opaTest("Test name 2", function(Given, When, Then) {/*...*/});
								/*...*/
							});
						</code></pre>
						<sample>Todo List Journey=test/integration/TodoListJourney.js</sample>
					</section>
					<section>
						<h4><strong>Loading</strong> pages & journeys</h4>
						<ul>
							<li>Ensure <strong>qUnit</strong> is loaded</li>
							<li>Load OPA, pages & journeys</li>
							<li><strong>Start</strong></li>
						</ul>
						<pre><code data-trim data-noescape>
							sap.ui.require([
								"sap/ui/test/Opa5",
								/* pages */
								/* journeys */
							], function(Opa5) {
								Opa5.extendConfig({
									/* Default settings */
								});
								QUnit.start();
							});
						</code></pre>
						<sample>All Journeys=test/integration/AllJourneys.js</sample>
						<small><span class="pre">QUnit.start()</span> is not present in AllJourneys.js because of <strong>Continuous Integration</strong></small>
					</section>
				</section>
				<section>
					<section>
						<h3>Anatomy of <strong>waitFor</strong></h3>
					</section>
					<section>
						<h4><strong>Presentation</strong> of waitFor</h4>
						<ul>
							<li><strong>Main</strong> entry point to <strong>synchronize</strong> tests with the running application</li>
							<br/>
							<li><strong>Locate</strong> and <strong>interact</strong> with UI5 controls</li>
						</ul>
					</section>
					<section>
						<h4>waitFor is <strong>asynchronous</strong></h4>
						<pre><script>document.write(document.getElementById("opa_sample").innerHTML)</script></pre>
						<p>
							<span class="pre">waitFor</span>-based members fill an <strong>execution queue</strong><br/>
							<small class="hide">You can wait on the end of this queue using
							<a href="https://openui5.hana.ondemand.com/#/api/sap.ui.test.Opa5/methods/sap.ui.test.Opa5.emptyQueue"><span class="pre">sap.ui.test.Opa5.emptyQueue</span></a></small>
						</p>
					</section>
					<section>
						<h4><strong>Synchronization</strong> in asynchronous tests</h4>
						<p>Since the test function is executed <strong>before</strong> the application is started,
							<span class="pre">waitFor</span> is required to <strong>synchronize</strong>.<br/>
							For instance, to add a breakpoint:<p>
						<pre><code data-trim data-noescape>
							// Actions
							When.onTheAppPage.iEnterTextForNewItemAndPressEnter(S_NEW_ITEM_TITLE);
							When.onTheListOfItems.iSetTheItemToCompleted(S_NEW_ITEM_TITLE);

							When.waitFor({
								success: function() {
									debugger;
								}
							});

							When.onTheAppPage.iClearTheCompletedItems();
						</code></pre>
					</section>
					<section>
						<h4>waitFor <strong>options</strong></h4>
						<p>
							<ul>
								<li><span class="pre">waitFor</span> offers a large <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.test.Opa5/methods/waitFor"><strong>set of options</strong></a></li>
								<li>They can be <strong>grouped</strong> and <strong>sequenced</strong>:
									<ul>
										<li>Finding</li>
										<li>Filtering</li>
										<li>Checking</li>
										<li>Interacting</li>
										<li>Reporting</li>
										<li><i>(Configuring)</i></li>
									</ul>
								</li>
							</ul>
						</p>
					</section>
					<section>
						<h4><strong>Configuring</strong> - <span class="pre">timeout</span></h4>
						<ul>
							<li><span class="pre">timeout</span> decides of the maximum waiting time <i>(we use 15s)</i></li>
							<li class="hide"><span class="pre">pollingInterval</span> can be changed <i>(defaulted to 400ms)</i></li>
						</ul>
					</section>
					<section>
						<h4><strong>Finding</strong></h4>
						<hr />
						<div class="split">
							<div class="left">
								<ul>
									<li><span class="pre">id</span></li>
									<li><span class="pre">controlType</span></li>
									<li><span class="pre">viewNamespace</span> & <span class="pre">viewName</span></li>
									<li><span class="pre">searchOpenDialogs</span> <small>can be combined only with <span class="pre">controlType</span></small></li>
								</ul>
							</div>
							<div class="right">
								<pre><code data-trim data-noescape>
									iEditTheItem: function(sTitle) {
										return this.waitFor({
											controlType: "sap.m.ObjectListItem",
											/* ... */
										});
									}
								</code></pre>
							</div>
						</div>
						<hr />
						<small>No criteria means <strong>all controls</strong></small>
						<br/>
						<small>Polling until <strong>at least one control is found</strong> or timeout</small>
					</section>
					<section>
						<h4><strong>Filtering</strong> (<span class="pre">matchers</span>)</h4>
						<small>Given the resultset of previous step</small>
						<hr />
						<div class="split">
							<div class="left">
								For <strong>each</strong> control:
								<ul>
									<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Falsy"><strong>falsy</strong></a> filters out</li>
									<li><strong><span class="pre">true</span></strong> keeps as-is</li>
									<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Truthy"><strong>truthy</strong></a> replaces</li>
								</ul>
							</div>
							<div class="right">
								<pre><code data-trim data-noescape>
									iEditTheItem: function(sTitle) {
										return this.waitFor({
											controlType: "sap.m.ObjectListItem",
											matchers: [new Properties({
												title: sTitle
											})],
											/* ... */
										});
									}
								</code></pre>
							</div>
						</div>
						<small>Use one of the <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.test.matchers"><strong><span class="pre">sap.ui.test.matchers</span></strong></a> or a <strong>function</strong></small>
						<hr />
						<small>Polling until <strong>remaining results</strong> or timeout</small>
					</section>
					<section>
						<h4><strong>Checking</strong> (<span class="pre">check</span>)</h4>
						<small>Given the resultset of previous step</small>
						<hr />
						<div class="split">
							<div class="left">
								<ul>
									<li>Accept or reject <strong>all</strong> results</li>
								</ul>
							</div>
							<div class="right">
								<pre><code data-trim data-noescape>
									iShouldNotSeeAnyItemTitled: function(sTitle) {
										return this.waitFor({
											controlType: "sap.m.ObjectListItem",
											check: function(aItems) {
												return aItems.every(function(oItem) {
													return oItem.getTitle() !== sTitle;
												});
											},
											/* ... */
										});
									}
								</code></pre>
							</div>
						</div>
						<hr />
						<small>Polling until <strong>truthy</strong> or timeout</small>
					</section>
					<section>
						<h4><strong>Interacting</strong> (<span class="pre">actions</span>)</h4>
						<small>Given the resultset of previous step</small>
						<hr />
						<div class="split">
							<div class="left">
								<ul>
									<li><a href="https://openui5.hana.ondemand.com/#/api/sap.ui.test.actions.Press"><strong>Press</strong></a></li>
									<li><a href="https://openui5.hana.ondemand.com/#/api/sap.ui.test.actions.EnterText"><strong>EnterText</strong></a></li>
									<li>Applied on <strong>all</strong> controls</li>
									<li><strong>Adapts</strong> to the control<br />
										<small>For instance, Press on a search field will trigger the search and EnterText will enter search
										criteria.</small>
									</li>
								</ul>
							</div>
							<div class="right">
								<pre><code data-trim data-noescape>
									iSetTheTitleTo: function(sTitle) {
										return this.waitFor({
											id: "title",
											actions: [new EnterText({
												text: sTitle
											})],
											/* ... */
										});
									}
								</code></pre>
							</div>
						</div>
						<small>Use one of the <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.test.actions"><strong><span class="pre">sap.ui.test.actions</span></strong></a></small>
						<hr />
					</section>
					<section>
						<h4><strong>Reporting</strong> (<span class="pre">success / error / errorMessage</span>)</h4>
						<ul>
							<li>Final step of the <span class="pre">waitFor</span>, receives resultset</li>
							<li><strong>Avoid</strong> testing controls' state in success function</li>
							<li class="hide">Can chain to a <strong>subsequent <span class="pre">waitFor</span></strong></li>
						</ul>
						<pre><code data-trim data-noescape>
							iShouldSeeAGivenNumberOfItems: function(iCount) {
								return this.waitFor({
									controlType: "sap.m.ListBase",
									matchers: [new AggregationLengthEquals({
										name: "items",
										length: iCount
									})],
									success: function() {
										Opa5.assert.ok(true, "The list shows " + iCount + " items");
									},
									errorMessage: "The list doesn't show " + iCount + " items"
								});
							}
						</code></pre>
					</section>
					<section>
						<h4><strong>Configuring</strong> - <span class="pre">autoWait</span></h4>
						<ul>
							<li><strong>Not enabled</strong> by default</li>
							<li>When enabled, <span class="pre">waitFor</span> monitors <strong>pending tasks</strong>
								<small>requests, timeouts, promises, UI navigation...</small><br/>
								and includes the <strong>Interactable matcher</strong><br/>
								<small>Controls states are tested to check that they are 'available' and 'interactable'</small>
							</li>
							<br />
							<li>Use <span class="pre">sap.ui.test.Opa5.extendConfig</span> to <strong>set it globally</strong></li>
							<li>Can be <strong>turned off</strong> in a specific <span class="pre">waitFor</span><br />
								<small>For instance if you want to check that a button is disabled</small>
							</li>
						</ul>
					</section>
					<section class="hide">
						<h4><strong>Configuring</strong> - <span class="pre">visible</span></h4>
						<ul>
							<li>To find controls that are <strong>not visible</strong> <i>from a UI5 point of view</i></li>
						</ul>
						<pre><code data-trim data-noescape>
							// iShouldNotSeeTheField(sId, sName)
							return this.waitFor({
								autoWait: false,
								visible: false,
								id: sId,
								matchers: [new Properties({
									visible: false
								})],
								success: function() {
									Opa5.assert.ok(true, "The " + sName + " field is *not* displayed");
								},
								errorMessage: "The " + sName + " field is displayed"
							});
						</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h3><strong>Mocking</strong> Backend</h3>
					</section>
					<section>
						<h4>The <strong>need</strong> for a backend</h4>
						<p>When the application has a backend counterpart, it <strong>can't run</strong> without being connected to it.</p>
						<p>However, tests have to rely on a <strong>stable dataset</strong> and some features might be <strong>dangerous</strong>.</p>
					</section>
					<section>
						<h4>Introducing the <strong>MockServer</strong></h4>
						<img src="UI5Con'18%20A%20journey%20with%20OPA/MockServer.png" style="border: 0; max-width: 40%; max-height: 40%;" align="left"/>
						<br/>
						<p>The MockServer is a software component that <strong>captures</strong> AJAX requests and either <strong>answer them</strong> or <strong>let them reach</strong> the backend.<p>
					</section>
					<section>
						<h4><strong>Configuring</strong> the MockServer</h4>
						<ul>
							<li>It <strong>requires the metadata</strong> to know the entities and relationships exposed by the ODATA service</li>
							<li>It <strong>initializes the entity sets</strong> by generating them or loading JSON files</li>
						</ul>
						<pre><code data-trim data-noescape>
							_oMockServer = new MockServer({
								rootUri: "/odata/TODO_SRV/"
							});
							_oMockServer.simulate("model/metadata.xml", {
								sMockdataBaseUrl: "model/"
							});
							_oMockServer.start();
						</code></pre>
						<small>Check the documentation of <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.core.util.MockServer"><strong><span class="pre">sap.ui.core.util.MockServer</span></strong></a></small>
					</section>
					<section>
						<h4>MockServer <strong>entities</strong></h4>
						<p>At <strong>any time</strong>, one can <strong>manipulate</strong> the entities</p>
						<pre><code data-trim data-noescape>
							var aExisting = _oMockServer.getEntitySetData("TodoItemSet"),
								sGuid = "0MOCKSVR-TODO-MKII-MOCK-00009999";
							// Adding a new entity
							aExisting.push({
								"Guid": sGuid,
								"Title": "Generated",
								"Completed": false,
								"DueDate": "/Date(" + new Date(2099, 11, 31).getTime() + ")/",
								"__metadata": {
									id: "/odata/TODO_SRV/TodoItemSet(guid'" + sGuid + "')",
									uri: "/odata/TODO_SRV/TodoItemSet(guid'" + sGuid + "')",
									type: "TODO_SRV.TodoItem"
								}
							});
							_oMockServer.setEntitySetData("TodoItemSet", aExisting);
						</code></pre>
						<sample>?randomize=test/MockServer.js#L83</sample>
					</section>
					<section>
						<h4><strong>Default</strong> MockServer hooks</h4>
						<p>By default, the MockServer hooks a lot of<br/><strong>ODATA operations</strong> :</p>
						<ul>
							<li><strong>$batch</strong><br/><small><i>(transparently split into individual requests and consolidates results)</i></small></li>
							<li><strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate and <strong>D</strong>elete</li>
							<li><strong>Query</strong> parameters: paging, filtering, sorting</li>
							<li>Resolving <strong>navigation</strong> properties<br/><small><i>One level only</i></small></li>
						</ul>
						<p>But function imports are <strong>not supported</strong></p>
					</section>
					<section>
						<h4><strong>Altering</strong> the MockServer hooks</h4>
						<p>An hook is defined with:</p>
						<ul>
							<li><strong><span class="pre">method</span></strong>: GET, POST, PUT...</li>
							<li><strong><span class="pre">path</span></strong>: a <strong>regexp</strong> matching the API URL<br/>
								<small>Using <strong>capturing group</strong>, you can extract url parameters</small>
							</li>
							<li><strong><span class="pre">response</span></strong> function: where the behavior is implemented</li>
						</ul>
					</section>
					<section>
						<h4><strong>Altering</strong> the MockServer hooks</h4>
						<pre><code data-trim data-noescape>
							var aRequests = _oMockServer.getRequests();
							aRequests.push({ // Creation of a todo list item
								method: "POST",
								path: CONST.OData.entityNames.todoItemSet,
								response: function(oXhr) {
									/* ... */
									// Initialize some fields
									var oBody = JSON.parse(oXhr.requestBody);
									oBody[CONST.OData.entityProperties.todoItem.completed] = false;
									oBody[CONST.OData.entityProperties.todoItem.completionDate] = null;
									oXhr.requestBody = JSON.stringify(oBody);
									return false; // Keep default processing
								}
							});
							_oMockServer.setRequests(aRequests);
						</code></pre>
						<sample>Creation of a todo list item=test/MockServer.js#L115</sample>
					</section>
					<section>
						<h4><strong>Adding</strong> new MockServer hooks</h4>
						<p>This is how <strong>function import</strong> can be implemented</p>
						<pre><code data-trim data-noescape>
							// Clear Completed
							aRequests.push({
								method: CONST.OData.functionImports.clearCompleted.method,
								path: CONST.OData.functionImports.clearCompleted.name,
								response: function(oXhr) {
									/* ... */
									oXhr.respond(200, {
										"Content-Type": "application/json;charset=utf-8"
									}, JSON.stringify({
										d: oResult
									}));
									return true; // Skip default processing
								}
							});
						</code></pre>
						<sample>Clear Completed=test/MockServer.js#L173</sample>
					</section>
					<section>
						<h4>MockServer hooks <strong>Tips & Tricks</strong></h4>
						<ul>
							<li>The MockServer does <strong>not</strong> need to be <strong>100% equivalent</strong> to the backend</li>
							<li>Newly added hooks are <strong>executed first</strong> (LIFO)</li>
							<li>You may also use <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.core.util.MockServer/methods/attachBefore"><strong><span class="pre">attachBefore</span></strong></a>
								 or <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.core.util.MockServer/methods/attachAfter"><strong><span class="pre">attachAfter</span></strong></a> callbacks triggered before or after request processing</li>
						</ul>
					</section>
				</section>
				<section>
					<h3>Key <strong>Take-Aways</strong></h3>
					<ul>
						<li><q>If it's not tested, it doesn't work</q></li>
						<li>OPA is designed to <strong>automate</strong> and <strong>validate</strong> UI5 applications</li>
						<li><strong>Asynchronous</strong> with <strong>active polling</strong></li>
						<li>Define pages to <strong>abstract</strong> and <strong>componentize</strong> UI</li>
						<li>Keep the journeys <strong>readable</strong></li>
						<li>Use MockServer <strong>to simulate</strong> the backend</li>
						<li>
							<a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa">
								<img src="/gfx/GitHub.png" style="margin: 0; border: 0; box-shadow: unset;" />training-ui5con18-opa
							</a>
						</li>
					</ul>
				</section>
			</div>
		</div>
		<script src="/gpf/0.2.6/gpf.js"></script>
		<img id="running" src="http://localhost:8080/running.png" />
		<script>
			"use strict";

			function onLoad () {
				var isSampleAppAvailable = !!document.getElementById("running").naturalWidth;

				// Links should open in a new tab to keep the presentation state
				var missingSampleAppMsg = "Download the training-ui5con18-opa project and use grunt serve";
				window.missingSampleApp = function () {
					alert(missingSampleAppMsg);
				};
				[].slice.call(document.querySelectorAll("a")).forEach(function (node) {
					node.setAttribute("target", "_blank");
					if (node.getAttribute("href").indexOf("http://localhost") === 0) {
						if (!isSampleAppAvailable) {
							node.setAttribute("title", missingSampleAppMsg);
							node.setAttribute("href", "javascript:missingSampleApp()");
							node.className = "missingSampleApp";
						}
					}
				});
			}

			// Build agenda
			[].slice.call(document.querySelectorAll("h3"), 3).forEach(function (h3) {
				var item = document.createElement("li");
				[].slice.call(h3.childNodes, 0).forEach(function (node) {
					item.appendChild(node.cloneNode(true));
				});
				this.appendChild(item);
			}, document.getElementById("agenda"));
			// Remove hidden slides
			[].slice.call(document.querySelectorAll(".hide")).forEach(function (node) {
				node.parentNode.removeChild(node);
			});
			// Replace tabs with double spaces in code samples to reduce code width
			[].slice.call(document.querySelectorAll("code")).forEach(function (node) {
				node.innerHTML = node.innerHTML.replace(/	/g, "  ");
			});
			// Reformat code samples
			var small = gpf.web.createTagFunction("small"),
				a = gpf.web.createTagFunction("a"),
				base = "https://github.com/ArnaudBuchholz/training-ui5con18-opa/blob/master/webapp/"; // or "http://localhost:8080/"
			[].slice.call(document.querySelectorAll("sample")).forEach(function (node) {
				var parts = node.innerHTML.split("="),
					tag = small([
						"An example from the sample application: ",
						a({
							href: base  + parts[1]
						}, parts[0])
					]);
				node.innerHTML = "";
				tag.appendTo(node);
			});
			// Load reveal
			gpf.require.define({Reveal: "reveal.js"}, function (require) {
				"use strict";
				require.Reveal.configure({
					slideNumber: "c/t",
					allottedTime: 40 * 60 * 1000, // 40 minutes
					progressBarHeight: 10,
					barColor: 'rgb(200,0,0)',
					pausedBarColor: 'rgba(200,0,0,.6)'
				});
			});
		</script>
	</body>
</html>
