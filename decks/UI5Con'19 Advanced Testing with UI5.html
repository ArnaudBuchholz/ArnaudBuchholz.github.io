<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="description" content="UI5Con'19 Advanced Testing with UI5">
		<meta name="author" content="Arnaud Buchholz">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
		<meta name="deck-duration" content="30">
		<link rel="stylesheet" type="text/css" href="styles.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<section>
						<table>
							<tr>
								<td width="50%">
									<small>
										<a href="https://en.wikipedia.org/wiki/Advanced_Test_Reactor">Advanced test reactor
											<img src="UI5Con'19 Advanced Testing with UI5/Advanced_Test_Reactor.jpg" style="margin: 0; border: 0; box-shadow: unset; border-radius: 16px;"></img>
										</a>
									</small>
								</td>
								<td style="vertical-align: top;">
									<h3 data-agenda="no">Advanced <strong>Testing</strong> with <strong>UI5</strong></h3>
									<p>
										<small>
											Presented by <a href="https://github.com/ArnaudBuchholz">Arnaud Buchholz</a>
											<br/>
											Presentation made with <a href="https://github.com/hakimel/reveal.js">Reveal.js</a>
										</small>
									</p>
									<br />
									<img src="UI5Con'18 A journey with OPA/OpenUI5_new_big_side.png" height="75px" style="border: 0;" />
									<img src="UI5Con'18 A journey with OPA/UI5Con.png" height="75px" style="border: 0;" />
								</td>
							</tr>
						</table>
					</section>
					<section include="me.html"></section>
					<section>
						<h3 data-agenda="no"><strong>Agenda</strong></h3>
						<ul id="agenda"></ul>
					</section>
					<section>
						<h4>Presented <img src="/gfx/GitHub.png" style="margin: 0; border: 0; box-shadow: unset;" /><strong>projects</strong></h4>
						<ul>
							<li>
								<a href="https://openui5.org/">OpenUI5</a><br />
								<small>An enterprise-grade, responsive &amp; open source <strong>UI framework</strong></small>
							</li>
							<li>
								<a href="https://github.com/ArnaudBuchholz/training-ui5Con18-opa">training-ui5con18-opa</a><br />
								<small>A <strong>todo list</strong> developed with <strong>OpenUI5</strong> to <strong>illustrate</strong></a> the testing concepts</small>
							</li>
							<li>
								<a href="https://github.com/jsdom/jsdom">jsdom</a><br />
								<small>A JavaScript implementation of the <strong>WHATWG DOM and HTML standards</strong>, for use with <strong>Node.js</strong></small>
							</li>
							<li>
								<a href="https://github.com/ArnaudBuchholz/node-ui5">node-ui5</a><br />
								<small>A <strong>Node.js</strong> wrapper for <strong>OpenUI5</strong>, enabling advanced testing</small>
							</li>
						</ul>
						<p>
						</p>
					</section>
					<section>
						<h4><strong>About</strong> the presentation</h4>
						<ul>
							<li class="fragment">There is <strong>more than UI</strong> in UI5</li>
							<li class="fragment"><a href="https://github.com/SAP/ui5-tooling"><strong>UI5 tooling</strong></a> is the <strong>recommended</strong> solution for UI5 development</li>
							<br />
							<li class="fragment">This presentation is about <strong>unusual ways of leveraging UI5</strong> to test UI5 developments</li>
						</ul>
					</section>
				</section>
				<section>
					<section>
						<h3>UI5Con<strong>'18</strong></h3>
					</section>
					<section>
						<img src="From OPA to Node-UI5/UI5Con18.jpg" style="border: 0; max-width: 50%; max-height: 50%;" />
						<br />
						<small><a href="https://openui5.org/ui5con/material2018.html">UI5 sessions 2018</a></small>
						<p><strong>A journey with OPA</strong> at UI5Con<strong>'18</strong></p>
					</section>
					<section>
						<h4>What is <strong>O</strong>ne <strong>P</strong>age <strong>A</strong>cceptance?</h4>
						<p>OPA is a set of tools used to <strong>automate</strong> and <strong>validate</strong> UI
							and it comes with <strong>backend mocking</strong>.</p>
						<br/>
						<p>Tests are organized in <strong>Journeys</strong>, based on <strong>Pages</strong>
							to provide a <strong>readable abstraction</strong> of the UI.</p>
					</section>
					<section>
						<h4>The <strong>need</strong> for a backend</h4>
						<p>When the application has a backend counterpart, it <strong>can't run</strong> without being connected to it.</p>
						<p>However, tests have to rely on a <strong>stable dataset</strong> and some features might be <strong>dangerous</strong>.</p>
					</section>
					<section>
						<h4>Introducing the <strong>MockServer</strong></h4>
						<img src="UI5Con'18 A journey with OPA/MockServer.png" style="border: 0; max-width: 40%; max-height: 40%;" align="left"/>
						<br/>
						<p>The MockServer is a software component that <strong>captures</strong> AJAX requests and either <strong>answer them</strong> or <strong>let them reach</strong> the backend.<p>
					</section>
					<section>
						<h4><strong>DEMO</strong> Automated tests samples</h4>
						<small>
							<a href="http://localhost:8080/index.html">Application</a>
							<a href="http://localhost:8080/test/integration/opaTests.qunit.html">OPA tests</a>
						</small>
					</section>
					<section>
						<h4><strong>Learn</strong> more</h4>
						<br/>
						<a href="https://youtu.be/HiZq-kuIbt0">
							<img src="From OPA to Node-UI5/UI5con@SAP 2018 - A journey with OPA.png" style="border: 0; max-width: 50%; max-height: 50%;" />
						</a>
						<br />
						<small><a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa">training-ui5con18-opa</a></small>
					</section>
				</section>
				<section>
					<section>
						<h3>MockServer as a <strong>real</strong> server</h3>
					</section>
					<section>
						<h4>The <strong>request</strong></h4>
						<p>After UI5Con'18,<br />a <strong>colleague</strong> submitted a strange <strong>request</strong>.<p>
						<br />
						<p>His team needed a <strong>fake ODATA server</strong> to validate an unusual network configuration.</p>
					</section>
					<section>
						<h4>His <strong>prototype</strong></h4>
						<img src="From OPA to Node-UI5/MockServer server old.png" style="border: 0; max-width: 80%; max-height: 60%;" />
					</section>
					<section>
						<q>There must be a better way !</q>
						<p class="fragment">Why not running UI5 <strong>inside</strong> Node.js ?</p>
					</section>
					<section>
						<h4>Introducing <strong>jsdom</strong></h4>
						<p>jsdom <strong>simulates</strong> a browser <strong>inside</strong> Node.js.</p>
						<pre><code class="javascript">const dom = new JSDOM(`&lt;script id="sap-ui-bootstrap"
  src="resources/sap-ui-core.js"
  data-sap-ui-compatVersion="edge"
  data-sap-ui-frameOptions='allow'
  data-sap-ui-preload='async'>
&lt;/script>`, {
  url: "https://example.org/",
  referrer: "https://example.com/",
  contentType: "text/html",
  includeNodeLocations: true,
  storageQuota: 10000000
});</pre></code>
						<small><a href="https://github.com/jsdom/jsdom">https://github.com/jsdom/jsdom</a></small>
					</section>
					<section>
						<h4>jsdom <strong>Challenges</strong></h4>
						<ul>
							<li><strong>Huge</strong> framework and <strong>slow</strong> to start</li>
							<li>No <strong>synchronous</strong> requests</li>
							<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"><strong>CORS</strong></a></li>
							<li>Environments are <strong>isolated</strong><br />
								<i><small>(not able to run Node.js code in loaded scripts)</small></i></li>
						</ul>
					</section>
					<section>
						<h4>Rewriting <strong>XMLHttpRequest</strong></h4>
						<ul>
							<li>Enables loading of <strong>file system resources</strong></li>
							<li>Remote resources are handled <strong>natively</strong></li>
							<li>Synchronous code is handled with <a href="https://www.npmjs.com/package/deasync"><strong>DeAsync.js</strong></a></li>
						</ul>
					</section>
					<section>
						<h4><strong>DEMO</strong> MockServer server</h4>
						<small>
							<a href="http://localhost:8080/odata/TODO_SRV/$metadata">$metadata</a>
							<a href="http://localhost:8080/index.html?no-mock">Application</a>
						</small>
					</section>
				</section>
				<section>
					<section>
						<h3>UI5 <strong>inside</strong> Node.js</h3>
					</section>
					<section>
						<p>The MockServer <strong>proof of concept</strong> demonstrated
							that it is possible to <strong>run UI5 in Node.js</strong>.</p>
					</section>
					<section>
						<q>What else can be done ?</q>
						<br />
						<q class="fragment">Anything !</q>
					</section>
					<section>
						<h4>Introducing <strong>node-ui5</strong></h4>
						<small><a href="https://www.npmjs.com/package/node-ui5">https://www.npmjs.com/package/node-ui5</a></small>
						<p>node-ui5 <strong>wraps</strong> UI5 API <strong>in</strong> Node.js.</p>
						<pre><code>require('node-ui5').then(({sap}) => {
  sap.ui.require([
    /* module dependencies */
  ], function (/* module values */) {
	  /* ... */
  })
})</pre></code>
					</section>
					<section>
						<h4><strong>Benefits</strong> of running in Node.js</h4>
						<p><strong>Native</strong> support of <strong>latest JavaScript</strong> features:</p>
						<ul>
							<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">template literals</a></li>
							<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">arrow functions</a> for callbacks</li>
							<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">async functions</a>,
								<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await">await operator</a>
								<small><p>(node-ui5 provides <a href="https://www.npmjs.com/package/node-ui5#node-ui5-helpers"><strong>asynchronous wrappers</strong></a>)</p></small>
							</li>
						</ul>
						<p class="fragment">Easy to <strong>automate</strong>.</p>
					</section>
					<section>
						<h4><strong>DEMO</strong> Accessing MockServer server</h4>
						<small><a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa/blob/master/demos/test.js">demos/test.js</a></small>
						<pre><code>require('node-ui5')
  .then(({ sap }) => {
    sap.ui.require([
      'sap/ui/model/odata/v2/ODataModel',
      'node-ui5/promisify'
    ], async function (ODataModel) {
      console.log('Creating ODataModel...')
      const model = new ODataModel({
        serviceUrl: 'http://localhost:8080/odata/TODO_SRV'
      })
      console.log('Reading $metadata')
      await model.metadataLoaded()
      console.log('Reading TODO items')
      const { results } = await model.readAsync('/TodoItemSet')
      console.log(`Found ${results.length} todo items`)
      /* ... */</pre></code>

					</section>
				</section>
				<section>
					<section>
						<h3><strong>OData</strong> testing with UI5</h3>
					</section>
					<section>
						<h4><strong>OData</strong> testing</h4>
						<p>UI developers are the <strong>primary users</strong> of the ODATA service
							but they are not <strong>involved</strong> in ODATA testing.</p>
						<br />
						<p>Furthermore, testing <strong>usually</strong> focuses on <strong>CRUD</strong> methods
							and <strong>rarely</strong> on checking <strong>$metadata</strong>.</p>
					</section>
					<section>
						<h4><strong>DEMO</strong> ODATA testing with <strong>Postman</strong></h4>
						<small><a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa/blob/master/demos/postman_collection.json">demos/postman_collection.json</a></small>
						<!--
						$metadata retreive
							how do you validate it?
							What if I want to check that a specific field has a label?
						single request with one result
						single request with multiple results
						batch (write it and analyse it)
					  -->
					</section>
					<section>
						<h4>ODATA in <strong>UI5</strong> applications</h4>
						<img src="From OPA to Node-UI5/SPA.png" style="border: 0; max-width: 50%; max-height: 50%;" align="left"/>
						<br/>
						<br/>
						<p>ODATA calls are made through the <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.model.odata.v2.ODataModel"><strong>ODataModel</strong></a> class.<p>
					</section>
					<section>
						<h4>ODataModel <strong>benefits</strong></h4>
						<ul>
							<li><strong>Validates</strong> $metadata
								<ul>
									<li>Provides <strong>description</strong> of entities</li>
								</ul>
							</li>
							<li>Encapsulate <strong>CRUD</strong>
								<ul>
									<li><strong>Deserialize</strong> entities</li>
									<li>Enables <strong>batching</strong> of requests</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h4><strong>DEMO</strong> ODATA testing with <strong>UI5</strong></h4>
						<small><a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa/blob/master/demos/postman.js">demos/postman.js</a></small>
					</section>
					<section>
						<h4>Considering the <strong>effort</strong></h4>
						<p>When <strong>building</strong> an application, a good practice is to also prepare the MockServer
							for <strong>OPA testing</strong>.</p>
						<p>The MockServer can be implemented the <strong>TDD way</strong>.</p>
						<p>To some extend, the <strong>same</strong> tests may apply to a <strong>real server</strong>.</p>
					</section>
					<section>
						<h4><strong>DEMO</strong> ODATA testing with <strong>UI5</strong> and <strong>qUnit</strong></h4>
						<small>
							<a href="http://localhost:8080/test/unit/unitTests.qunit.html?module=MockServer">qUnit tests of MockServer</a>
							<a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa/blob/master/demos/qunit-mockserver.js">demos/qunit-mockserver.js</a>
						</small>
					</section>
				</section>
				<section>
					<section>
						<h3>OPA <strong>end-to-end</strong> <i>(POC)</i></h3>
					</section>
					<section>
						<h4><strong>Integration</strong> Testing</h4>
						<img src="UI5Con'18%20A%20journey%20with%20OPA/test%20pyramid.png" style="border: 0; max-width: 50%; max-height: 50%;" align="left" />
						<p>OPA is used for <strong>integration testing</strong> but with <strong>no connection</strong> to the server.</p>
						<br />
						<small>Hence the use of MockServer</small>
					</section>
					<section>
						<h4><strong>end-to-end</strong> testing challenges</h4>
						<p>The application must be <strong>hosted</strong> on the server to access the <strong>ODATA service</strong>.</p>
						<p>Thanks to <strong>OPA concepts</strong>, the developer can <strong>automate</strong> the application.
						  However, the test code is <strong>not delivered</strong>.</p>
						<br />
						<p class="fragment">It is <strong>not possible</strong> to run OPA tests against a <strong>distant server</strong>.</p>
					</section>
					<section>
						<h4>node-ui5 <strong>proxy</strong> server</h4>
						<p>node-ui5 offers a <strong>configurable proxy server</strong> that <strong>flattens</strong>
							the system landscape.<p>
						<p>The OPA code can access the <strong>distant server</strong> as if it was <strong>local</strong>.</p>
					</section>
					<section>
						<h4><strong>DEMO</strong> OPA <strong>end-to-end</strong> testing</h4>
						<small>
							<a href="http://localhost:8080/demos/opa.html">OPA on OpenUI5 documentation</a>
						</small>
					</section>
				</section>
				<section>
					<h3>Key <strong>Take-Aways</strong></h3>
					<ul>
						<li>There is <strong>more than UI</strong> in UI5</li>
						<li><strong>node-ui5</strong> enables the use of UI5 <strong>in</strong> Node.js</li>
						<li>UI developers <strong>can</strong> help with <strong>backend testing</strong></li>
						<br />
						<li class="fragment">Experimenting is <strong>fun</strong> and leads to <strong>new ideas</strong></li>
					</ul>
				</section>
				<section>
					<section>
						<h3 data-agenda="no"><b>Workshop</b><br /><strong>Building</strong> a MockServer</h3>
					</section>
					<section>
						<h4>Prerequesites</h4>
						<ul>
							<li>Install <a href="https://nodejs.org/en/">LTS version</a> of <strong>Node.js</strong></li>
							<li>Clone / download <a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa"><strong>training-ui5con18-opa</strong></a></li>
							<li>Run <code><strong>npm i</strong></code> in the cloned / unzipped folder</li>
							<br />
							<li class="fragment">At the beginning of the workshop,<br />
								run <code><strong>npm run-script ui5con19</strong></code></li>
					</section>
					<section>
						<h4>The <strong>TDD</strong> way</h4>
						<p>The <strong>goal</strong> of this workshop is to <strong>pass all the tests</strong>.</p>
						<a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa/blob/master/webapp/test/unit/test/MockServer.js">webapp/test/unit/test/MockServer.js</a>
					</section>
					<section>
						<h4><strong>Initial</strong> MockServer</h4>
						<p>To achieve this goal, the initial MockServer <strong>implementation</strong> must be <strong>customized</strong>.</p>
						<a href="https://github.com/ArnaudBuchholz/training-ui5con18-opa/blob/master/workshop/ui5con19-mockserver/setup/webapp/test/MockServer.js">webapp/test/MockServer.js</a>
					</section>
					<section>
						<h4>Exposes <strong>predefined</strong> items</h4>
						<p>MockServer is capable of <strong>preloading</strong><br />entities from a <strong>JSON file</strong>.</p>
						<small>
							<ul>
								<li>Files <strong>location</strong> is given by <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.core.util.MockServer/methods/simulate">sMockdataBaseUrl</a></li>
								<li>File name must match the <strong>entity set</strong> <i>(case sensitively)</i></li>
								<li>It must contain an <strong>array of objects</strong></li>
								<li>Only define the <strong>necessary</strong> fields</li>
								<li>Date/Time fields use a <strong>specific format</strong></li>
							</ul>
						</small>
						<pre><code>"/Date(" + date.getTime() + ")/"</code></pre>
					</section>
					<section>
						<h4>Exposes <strong>more than 100</strong> items</h4>
						<p>Using <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.core.util.MockServer/methods/getEntitySetData">getEntitySetData</a>
							and <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.core.util.MockServer/methods/setEntitySetData">setEntitySetData</a>,
							one can <strong>manipulate</strong> the MockServer's entities.</p>
						<small>
							<ul>
								<li>Returned array contains a <strong>copy</strong> of MockServer's entities</li>
								<li>All fields <strong>must</strong>  be set, including <code>__metadata</code></li>
							</ul>
						</small>
						<pre><code class="javascript">oItem.__metadata = {
  uri: "/odata/TODO_SRV/TodoItemSet(guid'" + sGuid + "')",
  type: "TODO_SRV.TodoItem"
};</code></pre>
					</section>
					<section>
						<h4>Handles <strong>update</strong> of item</h4>
						<p>MockServer offers <strong>default</strong> CRUD implementations.</p>
						<p>Using <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.core.util.MockServer/methods/getRequests">getRequests</a>
							and <a href="https://openui5.hana.ondemand.com/#/api/sap.ui.core.util.MockServer/methods/setRequests">setRequests</a>,
						 <br />it is possible to <strong>alter</strong> their behavior.</p>
					</section>
					<section>
						<h4>Request <strong>definition</strong></h4>
						<pre><code>{
  method: "MERGE",
  path: CONST.OData.entityNames.todoItemSet + "\\(guid'([^']+)'\\)",
  response: function(oXhr, sCapturingGroupValue) {
    // oXhr.respond(iStatusCode, mHeaders, sBody);
    return true || false;
  }
}</pre></code>
						<small>
							<ul>
								<li><code>method</code> is the <strong>HTTP verb</strong> to match</li>
								<li><code>path</code> is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"><strong>regular expression</strong></a>
									matching the <strong>request URL</strong> <i>(string or RegExp)</i>
									<ul>
										<li><strong>capturing groups</strong>' values are passed to the <code>response</code> function</li>
									</ul>
								</li>
								<li><code>oXhr</code> simulates an <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"><strong>XMLHttpRequest</strong></a> object
									<ul>
										<li>Use <code>oxhr.respond</code> to <strong>answer</strong> the request</li>
									</ul>
								</li>
								<li>If the <code>response</code> function returns <strong>true</strong>,
									the MockServer won't <strong>search</strong> for another matching definition (LIFO)</li>
							</ul>
						</small>
					</section>
					<section>
						<h4>Handles <strong>creation</strong> of a new item</h4>
					</section>
					<section>
						<h4>Simulates an <strong>error</strong></h4>
						<p>It is important to <strong>check</strong> how an application<br /><strong>behaves</strong> in case of errors.</p>
					</section>
					<section>
						<h4>Implements ClearCompleted <strong>function import</strong></h4>
						<p>Unlike CRUD operations on entities,<br />
							the MockServer <strong>can't default</strong> function imports.</p>
					</section>
				</section>
			</div>
		</div>
		<script src="/gpf/0.2.9/gpf.js"></script>
		<script src="training-ui5con18-opa.js"></script>
		<script src="deck.js"></script>
	</body>
</html>
