<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: compatibility/timeout.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: compatibility/timeout.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file setTimeout polyfill
 * @since 0.1.5
 */
/*#ifndef(UMD)*/
"use strict";
/*global _GPF_HOST*/ // Host types
/*global _gpfAssert*/ // Assertion method
/*global _gpfEmptyFunc*/ // An empty function
/*global _gpfHost*/ // Host type
/*global _gpfMainContext*/ // Main context object
/*#endif*/

var
    // List of pending callbacks (sorted by execution time)
    _gpfTimeoutQueue = [],
    // Last allocated timeoutID
    _gpfTimeoutID = 0,
    // Sleep function
    _gpfSleep = _gpfEmptyFunc;

// Handle timeouts (mandatory for some environments)
gpf.handleTimeout = _gpfEmptyFunc;

// Sorting function used to reorder the async queue
function _gpfSortOnDt (a, b) {
    return a.dt - b.dt;
}

function _gpSetTimeoutPolyfill (callback, timeout) {
    _gpfAssert("number" === typeof timeout, "Timeout is required");
    var timeoutItem = {
        id: ++_gpfTimeoutID,
        dt: new Date(new Date().getTime() + timeout),
        cb: callback
    };
    _gpfTimeoutQueue.push(timeoutItem);
    _gpfTimeoutQueue.sort(_gpfSortOnDt);
    return _gpfTimeoutID;
}

function _gpfClearTimeoutPolyfill (timeoutId) {
    var pos;
    if (!_gpfTimeoutQueue.every(function (timeoutItem, index) {
        if (timeoutItem.id === timeoutId) {
            pos = index;
            return false;
        }
        return true;
    })) {
        _gpfTimeoutQueue.splice(pos, 1);
    }
}

/**
 * For WSCRIPT and RHINO environments, this function must be used to process the timeout queue when using
 * [setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout)
 * @since 0.1.5
 */
function _gpfHandleTimeout () {
    var queue = _gpfTimeoutQueue,
        timeoutItem,
        now;
    while (queue.length) {
        timeoutItem = queue.shift();
        now = new Date();
        if (timeoutItem.dt > now) {
            _gpfSleep(timeoutItem.dt - now);
        }
        timeoutItem.cb();
    }
}

// Used only for WSCRIPT &amp; RHINO environments
/* istanbul ignore next */
if ("undefined" === typeof setTimeout) {

    /*jshint wsh: true*/
    /*eslint-env wsh*/
    /*jshint rhino: true*/
    /*eslint-env rhino*/

    if (_GPF_HOST.WSCRIPT === _gpfHost) {
        _gpfSleep =  function (t) {
            WScript.Sleep(t); //eslint-disable-line new-cap
        };
    } else if (_GPF_HOST.RHINO === _gpfHost) {
        _gpfSleep = java.lang.Thread.sleep;
    } else {
        console.warn("No implementation for setTimeout");
    }

    _gpfMainContext.setTimeout = _gpSetTimeoutPolyfill;
    _gpfMainContext.clearTimeout = _gpfClearTimeoutPolyfill;

        /**
     * @gpf:sameas _gpfHandleTimeout
     * @since 0.1.5
     */
    gpf.handleTimeout = _gpfHandleTimeout;

}

/*#ifndef(UMD)*/

gpf.internals._gpfTimeoutQueue = _gpfTimeoutQueue;
gpf.internals._gpSetTimeoutPolyfill = _gpSetTimeoutPolyfill;
gpf.internals._gpfClearTimeoutPolyfill = _gpfClearTimeoutPolyfill;
gpf.internals._gpfHandleTimeout = _gpfHandleTimeout;

/*#endif*/
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="gpf.Error.html">Error</a></li><li><a href="gpf.Error.AbstractMethod.html">AbstractMethod</a></li><li><a href="gpf.Error.AssertionFailed.html">AssertionFailed</a></li><li><a href="gpf.Error.InvalidParameter.html">InvalidParameter</a></li><li><a href="gpf.Error.NotImplemented.html">NotImplemented</a></li></ul><h3>Namespaces</h3><ul><li><a href="gpf.html">gpf</a></li><li><a href="gpf.node.html">node</a></li><li><a href="gpf.web.html">web</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-CODESTYLE.html">CODESTYLE</a></li><li><a href="tutorial-COMPATIBILITY.html">COMPATIBILITY</a></li><li><a href="tutorial-LOADING.html">LOADING</a></li></ul><h3>Global</h3><ul><li><a href="global.html#abstractMethod">abstractMethod</a></li><li><a href="global.html#assertionFailed">assertionFailed</a></li><li><a href="global.html#invalidParameter">invalidParameter</a></li><li><a href="global.html#notImplemented">notImplemented</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon Nov 21 2016 23:06:16 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
